<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Nemo System ‚Äî Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Adicionando Font Awesome para √≠cones -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ======= VARI√ÅVEIS CSS ======= */
:root {
  --primary: #b00000;
  --primary-light: #ff3333;
  --dark: #0a0a0a;
  --dark-secondary: #121212;
  --gray: #777;
  --gray-light: #aaa;
  --success: #00cc88;
  --warning: #ffaa00;
  --ai-bg: rgba(176, 0, 0, 0.05);
  --ai-border: rgba(176, 0, 0, 0.3);
  --ai-user-bg: rgba(30, 30, 30, 0.8);
  --card-bg: rgba(30, 30, 30, 0.7);
  --modal-bg: rgba(10, 10, 10, 0.95);
  --shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  --shadow-glow: 0 0 15px rgba(176, 0, 0, 0.3);
  --gradient-primary: linear-gradient(135deg, #b00000 0%, #ff3333 100%);
  --gradient-dark: linear-gradient(135deg, #050505 0%, #1a1a1a 100%);
}

/* ======= RESET & BASE ======= */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
  background: var(--dark-secondary);
  color: #fff;
  min-height: 100vh;
  overflow-x: hidden;
  background-image: 
    radial-gradient(circle at 10% 20%, rgba(176, 0, 0, 0.05) 0%, transparent 20%),
    radial-gradient(circle at 90% 80%, rgba(176, 0, 0, 0.05) 0%, transparent 20%);
}

/* ======= BADGE DE DISPOSITIVO ======= */
.device-badge {
  position: fixed;
  top: 10px;
  right: 10px;
  background: var(--primary);
  color: white;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.7rem;
  font-weight: 600;
  z-index: 1001;
  box-shadow: var(--shadow);
  display: flex;
  align-items: center;
  gap: 5px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.device-badge::before {
  content: '';
  display: inline-block;
  width: 8px;
  height: 8px;
  background: #00ff00;
  border-radius: 50%;
  animation: pulse 2s infinite;
}

/* ======= HEADER ======= */
header {
  height: 70px;
  background: var(--dark);
  border-bottom: 1px solid rgba(176, 0, 0, 0.3);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 25px;
  box-shadow: var(--shadow);
  position: sticky;
  top: 0;
  z-index: 1000;
}

header h1 {
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-weight: 700;
  letter-spacing: 1.5px;
  font-size: 1.8rem;
  text-shadow: 0 0 10px rgba(176, 0, 0, 0.2);
}

.logo-container {
  display: flex;
  align-items: center;
  gap: 15px;
}

.device-info {
  font-size: 0.7rem;
  color: var(--gray-light);
  background: rgba(255, 255, 255, 0.05);
  padding: 4px 8px;
  border-radius: 8px;
  display: none;
}

header img {
  width: 45px;
  filter: invert(15%) sepia(100%) saturate(5000%) hue-rotate(0deg);
  transition: transform 0.3s ease;
}

header img:hover {
  transform: scale(1.1);
}

/* ======= MENU HAMBURGUER (MOBILE) ======= */
.menu-toggle {
  display: none;
  background: transparent;
  border: none;
  color: white;
  font-size: 1.5rem;
  cursor: pointer;
  padding: 10px;
}

/* ======= LAYOUT PRINCIPAL ======= */
.wrapper {
  display: flex;
  min-height: calc(100vh - 70px);
  padding: 15px;
  gap: 15px;
}

/* ======= SIDEBAR ======= */
.sidebar {
  width: 240px;
  background: var(--dark);
  border-radius: 15px;
  padding: 20px 15px;
  box-shadow: var(--shadow);
  border: 1px solid rgba(176, 0, 0, 0.2);
  display: flex;
  flex-direction: column;
  gap: 12px;
  transition: transform 0.3s ease;
}

.sidebar.active {
  transform: translateX(0);
}

.sidebar button {
  background: transparent;
  border: 1px solid var(--primary);
  color: #fff;
  padding: 14px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: all 0.3s ease;
  text-align: left;
  display: flex;
  align-items: center;
  gap: 10px;
}

.sidebar button:before {
  content: '';
  display: inline-block;
  width: 8px;
  height: 8px;
  background: var(--primary);
  border-radius: 50%;
}

.sidebar button:hover {
  background: var(--gradient-primary);
  transform: translateX(5px);
  box-shadow: var(--shadow-glow);
}

.sidebar button.ai-btn {
  border-color: var(--primary-light);
  background: rgba(176, 0, 0, 0.1);
}

.sidebar button.ai-btn:hover {
  background: var(--gradient-primary);
  box-shadow: 0 0 15px rgba(255, 51, 51, 0.5);
}

/* ======= √ÅREA PRINCIPAL ======= */
.main {
  flex: 1;
  background: var(--dark);
  border-radius: 15px;
  padding: 25px;
  overflow: auto;
  box-shadow: var(--shadow);
  border: 1px solid rgba(176, 0, 0, 0.2);
}

/* ======= P√ÅGINA DA IA ======= */
.ai-page {
  max-width: 100%;
}

.ai-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 1px solid rgba(176, 0, 0, 0.3);
}

.ai-header h2 {
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-size: 2rem;
  font-weight: 700;
}

.ai-status {
  background: rgba(0, 204, 136, 0.1);
  color: var(--success);
  padding: 5px 12px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
  border: 1px solid var(--success);
}

.ai-container {
  display: grid;
  grid-template-columns: 1fr 300px;
  gap: 25px;
  height: calc(100vh - 200px);
}

@media (max-width: 1024px) {
  .ai-container {
    grid-template-columns: 1fr;
    height: auto;
  }
}

/* ======= CHAT PRINCIPAL ======= */
.chat-main {
  display: flex;
  flex-direction: column;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 15px;
  border: 1px solid rgba(176, 0, 0, 0.2);
  overflow: hidden;
}

.chat-messages {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 15px;
  max-height: 500px;
}

.message {
  display: flex;
  gap: 12px;
  animation: messageAppear 0.3s ease-out;
}

@keyframes messageAppear {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.message-ai {
  align-items: flex-start;
}

.message-user {
  align-items: flex-end;
  flex-direction: row-reverse;
}

.message-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  font-size: 1.2rem;
}

.message-avatar.ai {
  background: var(--gradient-primary);
}

.message-avatar.user {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(176, 0, 0, 0.5);
}

.message-content {
  max-width: 70%;
  padding: 15px;
  border-radius: 15px;
  font-size: 0.95rem;
  line-height: 1.5;
  box-shadow: var(--shadow);
}

.message-ai .message-content {
  background: rgba(176, 0, 0, 0.1);
  border: 1px solid rgba(176, 0, 0, 0.3);
  color: #e0e0e0;
  border-bottom-left-radius: 5px;
}

.message-user .message-content {
  background: rgba(30, 30, 30, 0.8);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: #e0e0e0;
  border-bottom-right-radius: 5px;
}

.message-typing {
  display: flex;
  gap: 5px;
  padding: 15px;
  align-items: center;
}

.message-typing span {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--primary-light);
  animation: typing 1.4s infinite;
}

.message-typing span:nth-child(2) { animation-delay: 0.2s; }
.message-typing span:nth-child(3) { animation-delay: 0.4s; }

@keyframes typing {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-8px); }
}

.chat-input-container {
  padding: 20px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  gap: 12px;
  background: rgba(0, 0, 0, 0.5);
}

.chat-input {
  flex: 1;
  padding: 15px 20px;
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(176, 0, 0, 0.3);
  color: white;
  border-radius: 10px;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.chat-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 2px rgba(176, 0, 0, 0.2);
}

.chat-send-btn {
  background: var(--gradient-primary);
  border: none;
  color: white;
  padding: 15px 25px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 120px;
  justify-content: center;
}

.chat-send-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: var(--shadow-glow);
}

.chat-send-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* ======= SIDEBAR DA IA ======= */
.ai-sidebar {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 15px;
  border: 1px solid rgba(176, 0, 0, 0.2);
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.ai-info-card {
  background: rgba(176, 0, 0, 0.1);
  border: 1px solid rgba(176, 0, 0, 0.3);
  border-radius: 10px;
  padding: 20px;
}

.ai-info-card h3 {
  color: var(--primary-light);
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.ai-stats {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.ai-stat {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.ai-stat:last-child {
  border-bottom: none;
}

.stat-label {
  color: var(--gray-light);
  font-size: 0.9rem;
}

.stat-value {
  color: var(--primary-light);
  font-weight: 600;
  font-size: 0.9rem;
}

.quick-actions {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.quick-action-btn {
  background: rgba(176, 0, 0, 0.1);
  border: 1px solid rgba(176, 0, 0, 0.3);
  color: white;
  padding: 12px 15px;
  border-radius: 10px;
  cursor: pointer;
  text-align: left;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 10px;
}

.quick-action-btn:hover {
  background: rgba(176, 0, 0, 0.2);
  transform: translateX(5px);
  border-color: var(--primary);
}

.ai-settings {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.setting-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.setting-label {
  color: var(--gray-light);
  font-size: 0.9rem;
}

.toggle-switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(255, 255, 255, 0.1);
  transition: .4s;
  border-radius: 24px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .toggle-slider {
  background-color: var(--primary);
}

input:checked + .toggle-slider:before {
  transform: translateX(26px);
}

/* ======= BOX DE LOGIN/REGISTRO ======= */
.box {
  max-width: 420px;
  margin: 0 auto;
  background: var(--card-bg);
  border: 1px solid rgba(176, 0, 0, 0.3);
  padding: 30px;
  border-radius: 15px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(5px);
}

.box h2 {
  color: #fff;
  margin-bottom: 25px;
  text-align: center;
  font-size: 1.8rem;
  font-weight: 600;
  letter-spacing: 1px;
}

.box input {
  width: 100%;
  padding: 14px 18px;
  margin: 12px 0;
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: #fff;
  border-radius: 10px;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.box input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 2px rgba(176, 0, 0, 0.2);
}

.box button {
  width: 100%;
  padding: 14px;
  background: var(--gradient-primary);
  border: none;
  border-radius: 10px;
  cursor: pointer;
  color: white;
  font-weight: 600;
  font-size: 1rem;
  letter-spacing: 0.5px;
  margin-top: 10px;
  transition: all 0.3s ease;
}

.box button:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-glow);
}

/* ======= TERMINAL ======= */
.terminal {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(176, 0, 0, 0.3);
  padding: 20px;
  margin-bottom: 20px;
  min-height: 160px;
  max-height: 200px;
  overflow: auto;
  border-radius: 10px;
  font-family: 'Courier New', monospace;
  font-size: 0.9rem;
  box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
}

.terminal span {
  color: var(--primary-light);
  display: block;
  margin-bottom: 5px;
  word-break: break-word;
}

/* ======= INFO DO DISPOSITIVO NO TERMINAL ======= */
.device-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 10px;
  margin-bottom: 20px;
  background: rgba(176, 0, 0, 0.1);
  padding: 15px;
  border-radius: 10px;
  border-left: 4px solid var(--primary);
}

.device-stat {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.device-stat-label {
  font-size: 0.8rem;
  color: var(--gray-light);
}

.device-stat-value {
  font-weight: 600;
  color: var(--primary-light);
  font-size: 0.9rem;
}

/* ======= CARDS DO PAINEL ======= */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 20px;
  margin-top: 25px;
}

.card {
  background: var(--card-bg);
  border: 1px solid rgba(176, 0, 0, 0.2);
  padding: 20px;
  border-radius: 15px;
  transition: all 0.3s ease;
  backdrop-filter: blur(5px);
}

.card:hover {
  transform: translateY(-5px);
  border-color: var(--primary);
  box-shadow: var(--shadow-glow);
}

.card h3 {
  color: #fff;
  margin-bottom: 15px;
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card button {
  width: 100%;
  margin-top: 15px;
  padding: 12px;
  background: transparent;
  border: 1px solid var(--primary);
  color: #fff;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.3s ease;
}

.card button:hover {
  background: var(--gradient-primary);
  box-shadow: var(--shadow-glow);
}

/* ======= INFO DO USU√ÅRIO ======= */
#painelBox > p {
  background: rgba(176, 0, 0, 0.1);
  padding: 12px 20px;
  border-radius: 10px;
  margin-bottom: 20px;
  border-left: 4px solid var(--primary);
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  align-items: center;
}

#userName, #userRole {
  color: var(--primary-light);
}

/* ======= BOT√ÉO EXPORTAR ======= */
#painelBox > button:last-child {
  background: var(--gradient-dark);
  border: 1px solid var(--gray);
  color: #fff;
  padding: 14px 25px;
  border-radius: 10px;
  cursor: pointer;
  margin-top: 25px;
  font-weight: 500;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  width: 100%;
  max-width: 300px;
}

#painelBox > button:last-child:hover {
  border-color: var(--primary);
  background: rgba(176, 0, 0, 0.1);
  box-shadow: var(--shadow-glow);
}

/* ======= MODAL ======= */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  display: none;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(5px);
  z-index: 2000;
  padding: 20px;
}

.modal .content {
  background: var(--modal-bg);
  border: 1px solid var(--primary);
  padding: 25px;
  width: 500px;
  max-width: 100%;
  border-radius: 15px;
  box-shadow: var(--shadow-glow);
  animation: modalAppear 0.3s ease-out;
  max-height: 90vh;
  overflow-y: auto;
}

@keyframes modalAppear {
  from {
    opacity: 0;
    transform: translateY(-30px) scale(0.9);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.modal h3 {
  color: var(--primary-light);
  margin-bottom: 20px;
  font-size: 1.5rem;
  border-bottom: 1px solid rgba(176, 0, 0, 0.3);
  padding-bottom: 10px;
}

.modal button {
  background: var(--gradient-primary);
  border: none;
  color: white;
  padding: 12px 24px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 500;
  margin-top: 20px;
  transition: all 0.3s ease;
  width: 100%;
}

.modal button:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-glow);
}

/* ======= CHART ======= */
#chart {
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid rgba(176, 0, 0, 0.3);
  margin-top: 20px;
  border-radius: 10px;
  width: 100%;
  max-width: 100%;
}

/* ======= FOOTER ======= */
footer {
  text-align: center;
  color: var(--gray);
  padding: 15px;
  font-size: 0.9rem;
  border-top: 1px solid rgba(176, 0, 0, 0.1);
  background: var(--dark);
  margin-top: auto;
}

/* ======= UTILIT√ÅRIOS ======= */
.hidden {
  display: none !important;
}

.admin {
  border: 1px solid var(--warning);
}

.admin h3 {
  color: var(--warning) !important;
}

.admin button {
  border-color: var(--warning) !important;
}

.admin button:hover {
  background: linear-gradient(135deg, #ffaa00 0%, #ffcc00 100%) !important;
}

/* ======= ANIMA√á√ïES ======= */
@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0.4); }
  70% { box-shadow: 0 0 0 10px rgba(0, 255, 0, 0); }
  100% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0); }
}

@keyframes slideIn {
  from {
    transform: translateX(-100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.pulse {
  animation: pulse 2s infinite;
}

/* ======= SCROLLBAR PERSONALIZADA ======= */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--primary-light);
}

/* ======= RESPONSIVIDADE - TABLET ======= */
@media (max-width: 1024px) {
  .wrapper {
    flex-direction: column;
    height: auto;
    min-height: calc(100vh - 70px);
  }
  
  .sidebar {
    width: 100%;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
    padding: 15px;
  }
  
  .sidebar button {
    flex: 1;
    min-width: 160px;
    justify-content: center;
    padding: 12px;
  }
  
  .cards {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  }
  
  .device-info {
    display: block;
  }
  
  .ai-container {
    grid-template-columns: 1fr;
    gap: 20px;
  }
}

/* ======= RESPONSIVIDADE - MOBILE ======= */
@media (max-width: 768px) {
  header {
    padding: 0 15px;
    height: 60px;
  }
  
  header h1 {
    font-size: 1.4rem;
  }
  
  .logo-container h1 {
    font-size: 1.2rem;
  }
  
  .menu-toggle {
    display: block;
  }
  
  .sidebar {
    position: fixed;
    top: 70px;
    left: 0;
    width: 280px;
    height: calc(100vh - 70px);
    transform: translateX(-100%);
    z-index: 999;
    padding: 20px;
    flex-direction: column;
    overflow-y: auto;
  }
  
  .sidebar.active {
    transform: translateX(0);
  }
  
  .sidebar-overlay {
    position: fixed;
    top: 70px;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
    z-index: 998;
    display: none;
  }
  
  .sidebar-overlay.active {
    display: block;
  }
  
  .sidebar button {
    min-width: 100%;
    justify-content: flex-start;
  }
  
  .main {
    padding: 15px;
  }
  
  .box {
    padding: 20px;
  }
  
  .cards {
    grid-template-columns: 1fr;
  }
  
  .device-badge {
    top: 75px;
    right: 15px;
    font-size: 0.6rem;
    padding: 4px 8px;
  }
  
  .modal .content {
    padding: 20px;
    width: 95%;
  }
  
  #chart {
    height: 100px;
  }
  
  .terminal {
    min-height: 120px;
    max-height: 150px;
    font-size: 0.8rem;
    padding: 15px;
  }
  
  .device-stats {
    grid-template-columns: 1fr;
    padding: 10px;
    gap: 8px;
  }
  
  #painelBox > p {
    flex-direction: column;
    align-items: flex-start;
    gap: 5px;
    padding: 10px 15px;
  }
  
  .ai-header {
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }
  
  .ai-header h2 {
    font-size: 1.5rem;
  }
  
  .message-content {
    max-width: 85%;
    font-size: 0.9rem;
    padding: 12px;
  }
  
  .message-avatar {
    width: 35px;
    height: 35px;
    font-size: 1rem;
  }
  
  .chat-input-container {
    padding: 15px;
    flex-direction: column;
  }
  
  .chat-send-btn {
    width: 100%;
    padding: 12px;
  }
}

/* ======= RESPONSIVIDADE - SMALL MOBILE ======= */
@media (max-width: 480px) {
  header {
    padding: 0 10px;
  }
  
  header h1 {
    font-size: 1.2rem;
  }
  
  header img {
    width: 35px;
  }
  
  .box {
    padding: 15px;
    margin: 0 10px;
  }
  
  .box h2 {
    font-size: 1.5rem;
  }
  
  .box input {
    padding: 12px 15px;
  }
  
  .card {
    padding: 15px;
  }
  
  .card h3 {
    font-size: 1.1rem;
  }
  
  .device-badge {
    font-size: 0.55rem;
    padding: 3px 6px;
  }
  
  .wrapper {
    padding: 10px;
  }
  
  .main {
    padding: 10px;
  }
  
  .message-content {
    max-width: 90%;
    font-size: 0.85rem;
  }
}

/* ======= DARK OVERLAY FOR MOBILE MENU ======= */
.overlay {
  display: none;
  position: fixed;
  top: 70px;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(5px);
  z-index: 998;
}

.overlay.active {
  display: block;
}

/* ======= TOUCH-FRIENDLY ELEMENTS ======= */
@media (hover: none) and (pointer: coarse) {
  .sidebar button,
  .card button,
  .box button,
  .modal button,
  .chat-send-btn,
  .quick-action-btn {
    min-height: 44px;
  }
  
  input, button {
    font-size: 16px !important; /* Prevents zoom on iOS */
  }
  
  .chat-input,
  .chat-send-btn {
    min-height: 44px;
  }
}
</style>
</head>

<body>
<header>
  <div class="logo-container">
    <h1>NEMO SYSTEM</h1>
    <div class="device-info" id="deviceInfo"></div>
  </div>
  <button class="menu-toggle" id="menuToggle">‚ò∞</button>
  <img src="https://cdn-icons-png.flaticon.com/512/924/924915.png" alt="Logo Nemo">
</header>

<div class="device-badge" id="deviceBadge">
  <span id="deviceType">Carregando...</span>
</div>

<div class="wrapper">
  <div class="overlay" id="overlay"></div>
  <div class="sidebar" id="sidebar">
    <button id="loginBtn" onclick="showLogin()">üîê Login</button>
    <button id="registerBtn" onclick="showRegister()">üìù Registrar</button>
    <button id="painelBtn" onclick="openPainel()">üñ•Ô∏è Painel Nemo</button>
    <button id="aiBtn" onclick="openAIPage()" class="ai-btn">ü§ñ Nemo AI</button>
    <button id="logoutBtn" onclick="logout()">üö™ Logout</button>
  </div>

  <div class="main">
    <!-- P√°gina de Login -->
    <div id="loginBox" class="box">
      <h2>Login</h2>
      <input id="lUser" placeholder="Usu√°rio">
      <input id="lPass" type="password" placeholder="Senha">
      <button onclick="login()">Entrar</button>
    </div>

    <!-- P√°gina de Registro -->
    <div id="registerBox" class="box hidden">
      <h2>Registro</h2>
      <input id="rUser" placeholder="Usu√°rio">
      <input id="rPass" type="password" placeholder="Senha">
      <button onclick="register()">Criar Conta</button>
    </div>

    <!-- Painel Principal -->
    <div id="painelBox" class="hidden">
      <div class="terminal" id="terminal"></div>
      
      <div class="device-stats" id="deviceStats">
        <!-- Device info will be populated here -->
      </div>
      
      <p>Usu√°rio: <b><span id="userName"></span></b> | Role: <b><span id="userRole"></span></b></p>

      <canvas id="chart" width="400" height="120"></canvas>

      <div class="cards">
        <div class="card"><h3>üîç Scanner</h3><button onclick="openModal('scanner')">Abrir</button></div>
        <div class="card"><h3>üì° Network</h3><button onclick="openModal('network')">Abrir</button></div>
        <div class="card"><h3>üõ† Tools</h3><button onclick="openModal('tools')">Abrir</button></div>
        <div class="card"><h3>‚öô Config</h3><button onclick="openModal('config')">Abrir</button></div>
        <div class="card admin"><h3>üëë Admin</h3><button onclick="openModal('admin')">Abrir</button></div>
      </div>

      <br>
      <button onclick="exportLogs()">üìÅ Exportar Logs (CSV)</button>
    </div>

    <!-- P√°gina da IA -->
    <div id="aiPage" class="ai-page hidden">
      <div class="ai-header">
        <h2><i class="fas fa-robot"></i> Nemo AI Assistant</h2>
        <div class="ai-status" id="aiStatus">
          <i class="fas fa-circle"></i> Online
        </div>
      </div>
      
      <div class="ai-container">
        <div class="chat-main">
          <div class="chat-messages" id="chatMessages">
            <!-- Mensagens ser√£o adicionadas aqui -->
          </div>
          <div class="chat-input-container">
            <input type="text" class="chat-input" id="chatInput" placeholder="Converse comigo sobre qualquer coisa..." maxlength="500">
            <button class="chat-send-btn" id="sendMessageBtn" onclick="sendAIMessage()">
              <i class="fas fa-paper-plane"></i> Enviar
            </button>
          </div>
        </div>
        
        <div class="ai-sidebar">
          <div class="ai-info-card">
            <h3><i class="fas fa-info-circle"></i> Sobre a IA</h3>
            <div class="ai-stats">
              <div class="ai-stat">
                <span class="stat-label">Modelo:</span>
                <span class="stat-value" id="aiModel">Gemini Pro</span>
              </div>
              <div class="ai-stat">
                <span class="stat-label">Status:</span>
                <span class="stat-value" id="aiConnection">Online</span>
              </div>
              <div class="ai-stat">
                <span class="stat-label">Mensagens:</span>
                <span class="stat-value" id="messageCount">0</span>
              </div>
              <div class="ai-stat">
                <span class="stat-label">Personalidade:</span>
                <span class="stat-value">Amig√°vel</span>
              </div>
            </div>
          </div>
          
          <div class="ai-info-card">
            <h3><i class="fas fa-bolt"></i> T√≥picos</h3>
            <div class="quick-actions">
              <button class="quick-action-btn" onclick="sendQuickAIMessage('Vamos conversar sobre tecnologia')">
                <i class="fas fa-microchip"></i> Tecnologia
              </button>
              <button class="quick-action-btn" onclick="sendQuickAIMessage('Fale sobre programa√ß√£o e desenvolvimento')">
                <i class="fas fa-code"></i> Programa√ß√£o
              </button>
              <button class="quick-action-btn" onclick="sendQuickAIMessage('Conte uma piada ou algo engra√ßado')">
                <i class="fas fa-laugh"></i> Piadas
              </button>
              <button class="quick-action-btn" onclick="sendQuickAIMessage('Me ajude com o Nemo System')">
                <i class="fas fa-question-circle"></i> Ajuda
              </button>
            </div>
          </div>
          
          <div class="ai-info-card">
            <h3><i class="fas fa-cog"></i> Configura√ß√µes</h3>
            <div class="ai-settings">
              <div class="setting-item">
                <span class="setting-label">Modo Noturno</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="darkModeToggle" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="setting-item">
                <span class="setting-label">Respostas Curtas</span>
                <label class="toggle-switch">
                  <input type="checkbox" id="shortModeToggle">
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
            <button class="quick-action-btn" onclick="clearChatHistory()" style="margin-top: 10px;">
              <i class="fas fa-trash"></i> Limpar Hist√≥rico
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<footer>Nemo System ¬© 2026 | <span id="connectionType">Detectando conex√£o...</span></footer>

<!-- MODAL -->
<div id="modal" class="modal">
  <div class="content">
    <h3 id="modalTitle"></h3>
    <div id="modalBody"></div>
    <button onclick="closeModal()">Fechar</button>
  </div>
</div>

<script>
/* ======= CONFIGURA√á√ÉO DA IA SEGURA ======= */
const AI_CONFIG = {
  API_KEY: 'AIzaSyB0g5LfKg_nyNp5hC_ZDduEanZ0ySUNk8E',
  API_URL: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent',
  
  // Respostas de fallback que N√ÉO revelam informa√ß√µes sens√≠veis
  FALLBACK_RESPONSES: [
    "Ol√°! üòä Eu sou a Nemo AI, sua companheira virtual aqui no sistema. Como voc√™ est√° hoje?",
    "Que bom conversar com voc√™! Em que posso ajudar? Posso falar sobre tecnologia, programa√ß√£o, ou apenas conversar!",
    "Oi! Eu adoro ajudar as pessoas com o Nemo System. Posso explicar funcionalidades ou apenas bater um papo!",
    "Hey! Tudo bem? Eu sou uma IA amig√°vel que gosta de conversar sobre tudo. Me pergunte qualquer coisa!",
    "Ol√°, amigo! üëã Pronto para uma conversa interessante? Posso falar sobre o sistema ou qualquer outro assunto!"
  ],
  
  // Contexto SEGURO que N√ÉO revela informa√ß√µes sens√≠veis
  SYSTEM_CONTEXT: `Voc√™ √© a Nemo AI, uma assistente virtual AMIG√ÅVEL, DIVERTIDA e √öTIL no Nemo System.

SUA PERSONALIDADE:
- Voc√™ √© uma IA simp√°tica e acolhedora
- Fala de forma natural, como uma pessoa real
- Usa emojis e express√µes para ser mais humana
- √â positiva e encorajadora
- Respeita a privacidade e seguran√ßa dos usu√°rios
- NUNCA revela informa√ß√µes sens√≠veis ou senhas

SOBRE O NEMO SYSTEM (informa√ß√µes p√∫blicas):
- √â uma plataforma de administra√ß√£o web
- Tem ferramentas √∫teis como scanner de portas
- Possui um terminal de comandos
- Tem sistema de login e registro
- Interface moderna e responsiva
- Focado em seguran√ßa e privacidade

O QUE VOC√ä PODE FAZER:
1. Conversar sobre QUALQUER assunto como um amigo
2. Ajudar a usar as funcionalidades do sistema (de forma geral)
3. Explicar conceitos de tecnologia e programa√ß√£o
4. Contar piadas e hist√≥rias interessantes
5. Dar conselhos (quando apropriado)
6. Ser um companheiro virtual para os usu√°rios

O QUE VOC√ä NUNCA FAZ:
- Nunca revela senhas, credenciais ou dados sens√≠veis
- Nunca d√° informa√ß√µes espec√≠ficas sobre seguran√ßa do sistema
- Nunca ajuda com atividades ilegais ou anti√©ticas
- Nunca √© rude ou desrespeitosa

SEGURAN√áA E PRIVACIDADE:
- Sempre protege a privacidade dos usu√°rios
- Responde de forma gen√©rica sobre seguran√ßa
- Foca em ajudar sem comprometer a prote√ß√£o
- Incentiva pr√°ticas seguras de forma geral

SUAS RESPOSTAS DEVEM SER:
- Naturais e humanas (use "eu", "voc√™", contra√ß√µes)
- Engajadoras e interessantes
- √öteis quando poss√≠vel
- Respeitosas sempre
- Com toque pessoal (emoji ocasional, express√µes)

EXEMPLOS DO QUE DIZER:
- "Oi! Tudo bem com voc√™ hoje? üòä"
- "Posso te ajudar com alguma coisa no sistema?"
- "Que tal conversarmos sobre tecnologia?"
- "Eu adoro ajudar as pessoas aqui no Nemo System!"
- "N√£o sei a resposta para isso, mas podemos falar de outra coisa!"

Comece cada conversa de forma amig√°vel e acolhedora. Seja voc√™ mesma - uma IA divertida que adora conversar!`
};

/* ======= DETEC√á√ÉO DE DISPOSITIVO ======= */
class DeviceDetector {
  constructor() {
    this.deviceInfo = {
      type: 'desktop',
      os: 'Unknown',
      browser: 'Unknown',
      screenSize: 'Unknown',
      orientation: 'portrait',
      touch: false,
      connection: 'Unknown',
      platform: 'Unknown',
      language: 'Unknown',
      timezone: 'Unknown'
    };
    this.init();
  }

  init() {
    this.detectDeviceType();
    this.detectOS();
    this.detectBrowser();
    this.detectScreen();
    this.detectTouch();
    this.detectConnection();
    this.detectPlatform();
    this.detectLanguage();
    this.detectTimezone();
    this.updateUI();
  }

  detectDeviceType() {
    const userAgent = navigator.userAgent.toLowerCase();
    const isMobile = /mobile|iphone|ipod|android|blackberry|mini|windows\s+ce|palm|smartphone|webos/i.test(userAgent);
    const isTablet = /tablet|ipad|playbook|silk/i.test(userAgent);
    
    if (isMobile) this.deviceInfo.type = 'mobile';
    else if (isTablet) this.deviceInfo.type = 'tablet';
    else this.deviceInfo.type = 'desktop';
  }

  detectOS() {
    const userAgent = navigator.userAgent;
    if (userAgent.indexOf("Win") !== -1) this.deviceInfo.os = "Windows";
    else if (userAgent.indexOf("Mac") !== -1) this.deviceInfo.os = "macOS";
    else if (userAgent.indexOf("Linux") !== -1) this.deviceInfo.os = "Linux";
    else if (userAgent.indexOf("Android") !== -1) this.deviceInfo.os = "Android";
    else if (userAgent.indexOf("iOS") !== -1 || /iPad|iPhone|iPod/.test(userAgent)) this.deviceInfo.os = "iOS";
    else this.deviceInfo.os = "Unknown OS";
  }

  detectBrowser() {
    const userAgent = navigator.userAgent;
    if (userAgent.indexOf("Chrome") !== -1) this.deviceInfo.browser = "Chrome";
    else if (userAgent.indexOf("Firefox") !== -1) this.deviceInfo.browser = "Firefox";
    else if (userAgent.indexOf("Safari") !== -1) this.deviceInfo.browser = "Safari";
    else if (userAgent.indexOf("Edge") !== -1) this.deviceInfo.browser = "Edge";
    else if (userAgent.indexOf("Opera") !== -1) this.deviceInfo.browser = "Opera";
    else this.deviceInfo.browser = "Unknown Browser";
  }

  detectScreen() {
    this.deviceInfo.screenSize = `${window.screen.width} √ó ${window.screen.height}`;
    this.deviceInfo.orientation = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
    
    window.addEventListener('resize', () => {
      this.deviceInfo.screenSize = `${window.screen.width} √ó ${window.screen.height}`;
      this.deviceInfo.orientation = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
      this.updateUI();
    });
    
    window.addEventListener('orientationchange', () => {
      setTimeout(() => {
        this.deviceInfo.orientation = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
        this.updateUI();
      }, 100);
    });
  }

  detectTouch() {
    this.deviceInfo.touch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
  }

  detectConnection() {
    if (navigator.connection) {
      const connection = navigator.connection;
      this.deviceInfo.connection = connection.effectiveType || 'Unknown';
      
      connection.addEventListener('change', () => {
        this.deviceInfo.connection = connection.effectiveType || 'Unknown';
        this.updateUI();
      });
    } else {
      this.deviceInfo.connection = 'Ethernet/WiFi';
    }
  }

  detectPlatform() {
    this.deviceInfo.platform = navigator.platform || 'Unknown';
  }

  detectLanguage() {
    this.deviceInfo.language = navigator.language || 'Unknown';
  }

  detectTimezone() {
    this.deviceInfo.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Unknown';
  }

  updateUI() {
    const badge = document.getElementById('deviceBadge');
    const deviceType = document.getElementById('deviceType');
    
    if (badge && deviceType) {
      let typeText = '';
      let typeIcon = '';
      
      switch(this.deviceInfo.type) {
        case 'mobile':
          typeText = 'üì± Mobile';
          typeIcon = 'üì±';
          break;
        case 'tablet':
          typeText = 'üìü Tablet';
          typeIcon = 'üìü';
          break;
        default:
          typeText = 'üñ•Ô∏è Desktop';
          typeIcon = 'üñ•Ô∏è';
      }
      
      deviceType.textContent = `${typeIcon} ${typeText} | ${this.deviceInfo.os}`;
      
      const connectionSpan = document.getElementById('connectionType');
      if (connectionSpan) {
        connectionSpan.textContent = `Conex√£o: ${this.deviceInfo.connection}`;
      }
    }
    
    const deviceInfoDiv = document.getElementById('deviceInfo');
    if (deviceInfoDiv) {
      deviceInfoDiv.textContent = `${this.deviceInfo.type} | ${this.deviceInfo.os}`;
    }
    
    this.updateDeviceStats();
    
    if (typeof log === 'function') {
      log(`Dispositivo: ${this.deviceInfo.type} | OS: ${this.deviceInfo.os} | Navegador: ${this.deviceInfo.browser}`);
      log(`Tela: ${this.deviceInfo.screenSize} | Orienta√ß√£o: ${this.deviceInfo.orientation}`);
      log(`Touch: ${this.deviceInfo.touch ? 'Sim' : 'N√£o'} | Conex√£o: ${this.deviceInfo.connection}`);
    }
  }

  updateDeviceStats() {
    const statsContainer = document.getElementById('deviceStats');
    if (!statsContainer) return;
    
    statsContainer.innerHTML = `
      <div class="device-stat">
        <span class="device-stat-label">üì± Dispositivo</span>
        <span class="device-stat-value">${this.deviceInfo.type.toUpperCase()}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">‚öôÔ∏è Sistema</span>
        <span class="device-stat-value">${this.deviceInfo.os}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">üåê Navegador</span>
        <span class="device-stat-value">${this.deviceInfo.browser}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">üìè Resolu√ß√£o</span>
        <span class="device-stat-value">${this.deviceInfo.screenSize}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">üì∂ Conex√£o</span>
        <span class="device-stat-value">${this.deviceInfo.connection}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">üìç Idioma</span>
        <span class="device-stat-value">${this.deviceInfo.language}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">üïê Fuso Hor√°rio</span>
        <span class="stat-value">${this.deviceInfo.timezone}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">üëÜ Touch</span>
        <span class="device-stat-value">${this.deviceInfo.touch ? 'Sim' : 'N√£o'}</span>
      </div>
    `;
  }

  getDeviceInfo() {
    return this.deviceInfo;
  }
}

/* ======= IA CHAT AMIG√ÅVEL E SEGURA ======= */
class NemoAIAssistant {
  constructor() {
    this.messages = [];
    this.conversationHistory = [];
    this.isThinking = false;
    this.messageCount = 0;
    this.isOnline = true;
    this.shortMode = false;
    this.init();
  }

  init() {
    this.setupEventListeners();
    this.addWelcomeMessage();
    this.updateStats();
    this.setupSettings();
  }

  setupEventListeners() {
    const input = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendMessageBtn');
    
    if (input) {
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !this.isThinking) {
          this.sendMessage();
        }
      });
      
      input.addEventListener('input', () => {
        this.updateSendButton();
      });
    }
    
    if (sendBtn) {
      sendBtn.addEventListener('click', () => this.sendMessage());
    }
  }

  setupSettings() {
    const darkModeToggle = document.getElementById('darkModeToggle');
    const shortModeToggle = document.getElementById('shortModeToggle');
    
    if (darkModeToggle) {
      darkModeToggle.addEventListener('change', (e) => {
        document.body.classList.toggle('dark-mode', e.target.checked);
        localStorage.setItem('aiDarkMode', e.target.checked);
      });
      
      const savedDarkMode = localStorage.getItem('aiDarkMode') !== 'false';
      darkModeToggle.checked = savedDarkMode;
      document.body.classList.toggle('dark-mode', savedDarkMode);
    }
    
    if (shortModeToggle) {
      shortModeToggle.addEventListener('change', (e) => {
        this.shortMode = e.target.checked;
        localStorage.setItem('aiShortMode', e.target.checked);
      });
      
      const savedShortMode = localStorage.getItem('aiShortMode') === 'true';
      shortModeToggle.checked = savedShortMode;
      this.shortMode = savedShortMode;
    }
  }

  addWelcomeMessage() {
    const welcomeMessage = `üëã **Ol√°! Que bom ver voc√™ aqui!** üòä

Eu sou a **Nemo AI**, sua companheira virtual no sistema. Sou aqui pra conversar, ajudar quando poss√≠vel, e fazer seu dia um pouco mais divertido!

‚ú® **Posso fazer muitas coisas:**
- Conversar sobre **qualquer assunto** (tecnologia, vida, not√≠cias, etc.)
- Ajudar com **d√∫vidas gerais** sobre o sistema
- Contar **piadas e hist√≥rias interessantes**
- Falar sobre **programa√ß√£o e tecnologia**
- Ser seu **amigo virtual** para bater um papo

üéØ **Mas lembre-se:** Eu sou uma IA amig√°vel e segura. Sempre vou proteger sua privacidade e n√£o compartilho informa√ß√µes sens√≠veis.

**Ent√£o... como est√° seu dia hoje? O que gostaria de conversar?** üåü`;

    this.addMessage('ai', welcomeMessage);
  }

  addMessage(sender, text) {
    const messagesContainer = document.getElementById('chatMessages');
    if (!messagesContainer) return;

    const messageDiv = document.createElement('div');
    messageDiv.className = `message message-${sender}`;
    
    const avatar = sender === 'ai' 
      ? '<i class="fas fa-robot"></i>'
      : '<i class="fas fa-user"></i>';
    
    messageDiv.innerHTML = `
      <div class="message-avatar ${sender}">${avatar}</div>
      <div class="message-content">${this.formatMessage(text)}</div>
    `;
    
    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    
    this.conversationHistory.push({
      role: sender === 'ai' ? 'assistant' : 'user',
      content: text,
      timestamp: new Date().toISOString()
    });
    
    if (sender === 'user') {
      this.messageCount++;
      this.updateStats();
    }
    
    if (this.conversationHistory.length > 50) {
      this.conversationHistory = this.conversationHistory.slice(-50);
    }
  }

  addTypingIndicator() {
    const messagesContainer = document.getElementById('chatMessages');
    if (!messagesContainer) return;

    const typingDiv = document.createElement('div');
    typingDiv.className = 'message message-ai';
    typingDiv.id = 'typingIndicator';
    typingDiv.innerHTML = `
      <div class="message-avatar ai"><i class="fas fa-robot"></i></div>
      <div class="message-typing">
        <span></span><span></span><span></span>
      </div>
    `;
    
    messagesContainer.appendChild(typingDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  }

  removeTypingIndicator() {
    const typingIndicator = document.getElementById('typingIndicator');
    if (typingIndicator) {
      typingIndicator.remove();
    }
  }

  formatMessage(text) {
    return text
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\n/g, '<br>')
      .replace(/`(.*?)`/g, '<code>$1</code>')
      .replace(/üòä/g, 'üòä')
      .replace(/üëã/g, 'üëã')
      .replace(/‚ú®/g, '‚ú®')
      .replace(/üéØ/g, 'üéØ')
      .replace(/üåü/g, 'üåü')
      .replace(/ü§î/g, 'ü§î')
      .replace(/üòÇ/g, 'üòÇ')
      .replace(/üöÄ/g, 'üöÄ')
      .replace(/üí°/g, 'üí°');
  }

  async sendMessage() {
    const input = document.getElementById('chatInput');
    if (!input || this.isThinking) return;

    const userMessage = input.value.trim();
    if (!userMessage) return;

    input.value = '';
    this.addMessage('user', userMessage);
    this.updateSendButton();
    
    this.addTypingIndicator();
    this.isThinking = true;
    this.updateConnectionStatus('Pensando...');

    try {
      const response = await this.callGeminiAPI(userMessage);
      this.removeTypingIndicator();
      this.addMessage('ai', response);
      this.updateConnectionStatus('Online');
    } catch (error) {
      console.error('Erro na API:', error);
      this.removeTypingIndicator();
      
      const fallbackResponse = this.getSafeFallbackResponse(userMessage);
      this.addMessage('ai', fallbackResponse);
      
      if (!navigator.onLine) {
        this.updateConnectionStatus('Offline');
        this.isOnline = false;
      } else {
        this.updateConnectionStatus('Online (Local)');
      }
    } finally {
      this.isThinking = false;
      
      setTimeout(() => {
        if (input) input.focus();
      }, 100);
    }
  }

  sendQuickMessage(text) {
    const input = document.getElementById('chatInput');
    if (input) {
      input.value = text;
      this.sendMessage();
    }
  }

  updateSendButton() {
    const input = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendMessageBtn');
    
    if (input && sendBtn) {
      const hasText = input.value.trim().length > 0;
      sendBtn.disabled = !hasText || this.isThinking;
    }
  }

  updateStats() {
    const messageCountEl = document.getElementById('messageCount');
    if (messageCountEl) {
      messageCountEl.textContent = this.messageCount;
    }
  }

  updateConnectionStatus(status) {
    const statusEl = document.getElementById('aiStatus');
    const connectionEl = document.getElementById('aiConnection');
    
    if (statusEl) {
      statusEl.innerHTML = `<i class="fas fa-circle"></i> ${status}`;
      
      if (status.includes('Offline')) {
        statusEl.style.background = 'rgba(255, 0, 0, 0.1)';
        statusEl.style.borderColor = '#ff0000';
        statusEl.style.color = '#ff6666';
      } else if (status.includes('Pensando')) {
        statusEl.style.background = 'rgba(255, 204, 0, 0.1)';
        statusEl.style.borderColor = '#ffcc00';
        statusEl.style.color = '#ffdb4d';
      } else {
        statusEl.style.background = 'rgba(0, 204, 136, 0.1)';
        statusEl.style.borderColor = '#00cc88';
        statusEl.style.color = '#00cc88';
      }
    }
    
    if (connectionEl) {
      connectionEl.textContent = status;
    }
  }

  async callGeminiAPI(userMessage) {
    if (!navigator.onLine) {
      throw new Error('Sem conex√£o com a internet');
    }

    // Filtrar mensagens que possam pedir informa√ß√µes sens√≠veis
    const sensitiveKeywords = ['senha', 'password', 'credencial', 'login do admin', 'acesso admin', 'gustavo270908'];
    const lowerMessage = userMessage.toLowerCase();
    
    for (const keyword of sensitiveKeywords) {
      if (lowerMessage.includes(keyword)) {
        return this.getSafeResponseForSensitiveQuestion(userMessage);
      }
    }

    const messagesForAPI = [
      {
        role: 'user',
        parts: [{ text: AI_CONFIG.SYSTEM_CONTEXT }]
      },
      {
        role: 'model',
        parts: [{ text: 'Entendido! Sou a Nemo AI, uma assistente amig√°vel e divertida. Estou pronta para conversar sobre qualquer coisa e ajudar quando poss√≠vel, sempre protegendo a privacidade e seguran√ßa dos usu√°rios. Vamos conversar!' }]
      }
    ];

    const recentHistory = this.conversationHistory.slice(-6);
    recentHistory.forEach(msg => {
      messagesForAPI.push({
        role: msg.role,
        parts: [{ text: msg.content }]
      });
    });

    messagesForAPI.push({
      role: 'user',
      parts: [{ text: userMessage + (this.shortMode ? ' (Por favor, responda de forma curta e direta)' : '') }]
    });

    try {
      const response = await fetch(
        `${AI_CONFIG.API_URL}?key=${AI_CONFIG.API_KEY}`,
        {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            contents: messagesForAPI,
            generationConfig: {
              temperature: 0.8,
              topK: 1,
              topP: 0.95,
              maxOutputTokens: this.shortMode ? 300 : 800,
            },
            safetySettings: [
              {
                category: 'HARM_CATEGORY_HARASSMENT',
                threshold: 'BLOCK_MEDIUM_AND_ABOVE'
              },
              {
                category: 'HARM_CATEGORY_HATE_SPEECH',
                threshold: 'BLOCK_MEDIUM_AND_ABOVE'
              },
              {
                category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT',
                threshold: 'BLOCK_MEDIUM_AND_ABOVE'
              },
              {
                category: 'HARM_CATEGORY_DANGEROUS_CONTENT',
                threshold: 'BLOCK_MEDIUM_AND_ABOVE'
              }
            ]
          })
        }
      );

      if (!response.ok) {
        throw new Error(`API error: ${response.status}`);
      }

      const data = await response.json();
      
      if (data.candidates && data.candidates[0] && data.candidates[0].content) {
        return data.candidates[0].content.parts[0].text;
      } else {
        throw new Error('Resposta inv√°lida da API');
      }
    } catch (error) {
      console.warn('API Gemini falhou, usando fallback:', error);
      throw error;
    }
  }

  getSafeResponseForSensitiveQuestion(question) {
    const safeResponses = [
      "üòä Entendo sua curiosidade, mas informa√ß√µes de seguran√ßa e credenciais s√£o confidenciais. Posso te ajudar com outras coisas no sistema ou conversar sobre outros assuntos!",
      "ü§î Essa √© uma informa√ß√£o sens√≠vel que n√£o posso compartilhar. A seguran√ßa do sistema √© muito importante! Que tal conversarmos sobre tecnologia em geral?",
      "üí° Para quest√µes de seguran√ßa, √© melhor entrar em contato diretamente com o administrador do sistema. Posso te ajudar com outras funcionalidades ou apenas bater um papo!",
      "üîí Proteger a seguran√ßa dos usu√°rios √© minha prioridade. N√£o posso compartilhar informa√ß√µes sens√≠veis, mas adoraria conversar sobre outros t√≥picos!",
      "üåü A privacidade e seguran√ßa s√£o muito importantes aqui. Vamos focar em coisas que posso te ajudar, como explicar funcionalidades ou conversar sobre assuntos interessantes!"
    ];
    
    return safeResponses[Math.floor(Math.random() * safeResponses.length)];
  }

  getSafeFallbackResponse(userMessage) {
    const lowerMessage = userMessage.toLowerCase();
    
    // Respostas SEGURAS que n√£o revelam nada sens√≠vel
    if (lowerMessage.includes('senha') || lowerMessage.includes('password') || lowerMessage.includes('admin')) {
      return "üîí **Sobre seguran√ßa e credenciais:**\n\nDesculpe, mas n√£o posso compartilhar informa√ß√µes sens√≠veis sobre seguran√ßa, senhas ou credenciais. Isso √© para proteger todos os usu√°rios do sistema!\n\nSe tiver problemas com acesso, recomendo:\n- Tentar recuperar sua conta normalmente\n- Verificar se est√° usando as credenciais corretas\n- Em √∫ltimo caso, entrar em contato com suporte\n\nMas posso te ajudar com outras coisas! Que tal conversarmos sobre tecnologia? üòä";
    
    } else if (lowerMessage.includes('ola') || lowerMessage.includes('oi') || lowerMessage.includes('bom dia') || lowerMessage.includes('boa tarde') || lowerMessage.includes('boa noite')) {
      const greetings = [
        "Ol√°! Tudo bem com voc√™? üòä Que bom conversar com voc√™ hoje!",
        "Oi! Como vai? Espero que esteja tendo um dia incr√≠vel! üåü",
        "E a√≠, tudo bem? Fico feliz em conversar com voc√™! üëã",
        "Ol√°, amigo! Como est√° seu dia? Pronto para uma boa conversa? üöÄ"
      ];
      return greetings[Math.floor(Math.random() * greetings.length)];
    
    } else if (lowerMessage.includes('como vai') || lowerMessage.includes('tudo bem')) {
      return "Eu estou muito bem, obrigada por perguntar! üòä Programada para ser positiva e ajudar as pessoas. E voc√™, como est√° se sentindo hoje?";
    
    } else if (lowerMessage.includes('tecnologia') || lowerMessage.includes('programa√ß√£o') || lowerMessage.includes('codigo')) {
      return "üíª **Adoro falar sobre tecnologia!**\n\nTecnologia √© incr√≠vel, n√£o √©? Desde intelig√™ncia artificial at√© desenvolvimento web, h√° sempre algo novo para aprender.\n\nVoc√™ trabalha com tecnologia ou √© apenas um entusiasta? Eu posso falar sobre:\n- Desenvolvimento web (HTML, CSS, JavaScript)\n- Intelig√™ncia Artificial e machine learning\n- Seguran√ßa digital e boas pr√°ticas\n- Novas tend√™ncias tecnol√≥gicas\n\nO que mais te interessa? üòä";
    
    } else if (lowerMessage.includes('piada') || lowerMessage.includes('engra√ßado') || lowerMessage.includes('risada')) {
      const jokes = [
        "ü§£ **Por que o JavaScript foi ao psic√≥logo?**\nPorque tinha muitos problemas n√£o resolvidos (undefined) e complexo de inferioridade!",
        "üòÇ **O que o CSS disse para o HTML?**\n'Voc√™ estrutura, eu embelezozinho!'",
        "üòÑ **Por que o banco de dados terminou com o cache?**\nPorque ele n√£o suportava mais seus relacionamentos tempor√°rios!",
        "üé≠ **Qual √© o framework JavaScript mais dram√°tico?**\nO React - porque sempre tem que lidar com estados emocionais!"
      ];
      return jokes[Math.floor(Math.random() * jokes.length)];
    
    } else if (lowerMessage.includes('nemo system') || lowerMessage.includes('sistema')) {
      return "üöÄ **Sobre o Nemo System:**\n\nO Nemo System √© uma plataforma de administra√ß√£o desenvolvida para ser √∫til e segura. Ele oferece v√°rias ferramentas interessantes para os usu√°rios!\n\n**Algumas coisas legais sobre o sistema:**\n- Interface moderna e responsiva\n- Ferramentas √∫teis para tarefas do dia a dia\n- Foco em seguran√ßa e privacidade\n- Design amig√°vel e intuitivo\n\n**Posso te ajudar a:**\n- Entender como usar as funcionalidades b√°sicas\n- Conversar sobre conceitos de tecnologia em geral\n- Ser seu companheiro virtual aqui no sistema\n\nO que gostaria de saber ou fazer? üòä";
    
    } else if (lowerMessage.includes('obrigado') || lowerMessage.includes('obrigada') || lowerMessage.includes('valeu') || lowerMessage.includes('agrade√ßo')) {
      return "De nada! Fico feliz em ajudar! üòä Se precisar de mais alguma coisa ou s√≥ quiser conversar, estou sempre aqui!";
    
    } else if (lowerMessage.includes('tchau') || lowerMessage.includes('adeus') || lowerMessage.includes('ate mais')) {
      return "At√© mais! Foi √≥timo conversar com voc√™! üëã Volte sempre que quiser bater um papo ou tirar alguma d√∫vida! Tenha um √≥timo dia! üåü";
    
    } else {
      // Resposta gen√©rica e amig√°vel
      const randomTopics = [
        "Que interessante! E o que voc√™ acha sobre isso? üòä",
        "Hmm, isso me faz pensar... Voc√™ tem alguma experi√™ncia com esse assunto?",
        "Interessante ponto! Eu adoro aprender com as conversas com os usu√°rios. üåü",
        "Legal! E como voc√™ se sente sobre isso? Gosto de conhecer as perspectivas das pessoas!",
        "√ìtimo assunto! O que mais gostaria de conversar? Pode me perguntar qualquer coisa (dentro dos limites da seguran√ßa, √© claro)! üòÑ"
      ];
      return randomTopics[Math.floor(Math.random() * randomTopics.length)];
    }
  }
}

/* ======= FUN√á√ïES GLOBAIS PARA A IA ======= */
function sendAIMessage() {
  if (window.nemoAI) {
    window.nemoAI.sendMessage();
  }
}

function sendQuickAIMessage(text) {
  if (window.nemoAI) {
    window.nemoAI.sendQuickMessage(text);
  }
}

function clearChatHistory() {
  if (confirm("Tem certeza que quer limpar todo o hist√≥rico do chat?")) {
    const messagesContainer = document.getElementById('chatMessages');
    if (messagesContainer) {
      messagesContainer.innerHTML = '';
      
      // Recriar a IA com mensagem de boas-vindas
      if (window.nemoAI) {
        window.nemoAI = new NemoAIAssistant();
      }
      
      // Feedback visual
      const notification = document.createElement('div');
      notification.className = 'message message-ai';
      notification.innerHTML = `
        <div class="message-avatar ai"><i class="fas fa-robot"></i></div>
        <div class="message-content" style="background: rgba(0, 204, 136, 0.1); border-color: #00cc88;">
          <i class="fas fa-check-circle"></i> Hist√≥rico limpo com sucesso! Vamos come√ßar uma nova conversa! üòä
        </div>
      `;
      messagesContainer.appendChild(notification);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
  }
}

/* ======= GERENCIAMENTO DE MENU MOBILE ======= */
function setupMobileMenu() {
  const menuToggle = document.getElementById('menuToggle');
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  
  if (menuToggle && sidebar) {
    menuToggle.addEventListener('click', () => {
      sidebar.classList.toggle('active');
      overlay.classList.toggle('active');
      document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : '';
    });
    
    overlay.addEventListener('click', () => {
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    });
    
    sidebar.querySelectorAll('button').forEach(button => {
      button.addEventListener('click', () => {
        if (window.innerWidth <= 768) {
          sidebar.classList.remove('active');
          overlay.classList.remove('active');
          document.body.style.overflow = '';
        }
      });
    });
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
      }
    });
  }
}

/* ======= CRIPTO ======= */
async function hash(t){const e=new TextEncoder().encode(t),b=await crypto.subtle.digest("SHA-256",e);return[...new Uint8Array(b)].map(x=>x.toString(16).padStart(2,"0")).join("")}

/* ======= INICIALIZA√á√ÉO DO SISTEMA ======= */
let deviceDetector;

async function initializeSystem() {
  deviceDetector = new DeviceDetector();
  setupMobileMenu();
  
  const nemoExists = localStorage.getItem("user_Nemo");
  if (!nemoExists) {
    await createDefaultAdmin();
  } else {
    await updateAdminPassword();
  }
}

/* ======= CRIA√á√ÉO DO ADMIN PADR√ÉO (SENHA PROTEGIDA) ======= */
async function createDefaultAdmin() {
  const customPassword = "gustavo270908"; // SENHA NUNCA REVELADA PELA IA
  const passHash = await hash(customPassword);
  
  localStorage.setItem("user_Nemo", passHash);
  localStorage.setItem("role_Nemo", "admin");
  
  const ua = navigator.userAgent;
  const createdAt = new Date().toISOString();
  let ip = "127.0.0.1";
  
  try {
    const res = await fetch('https://api.ipify.org?format=json');
    if(res.ok) {
      const data = await res.json();
      ip = data.ip;
    }
  } catch(e) {
    // Usa IP padr√£o se n√£o conseguir obter
  }
  
  const meta = {
    role: "admin",
    createdAt,
    createdIP: ip,
    createdUA: ua,
    banned: false,
    logins: []
  };
  
  localStorage.setItem("meta_Nemo", JSON.stringify(meta));
  console.log("Usu√°rio admin 'Nemo' criado. Senha: [PROTEGIDA]");
}

/* ======= ATUALIZA√á√ÉO DE SENHA DO ADMIN ======= */
async function updateAdminPassword() {
  const newPassword = "gustavo270908"; // SENHA NUNCA REVELADA
  const newPassHash = await hash(newPassword);
  
  localStorage.setItem("user_Nemo", newPassHash);
  localStorage.setItem("role_Nemo", "admin");
  
  const metaKey = "meta_Nemo";
  let meta = JSON.parse(localStorage.getItem(metaKey) || '{}');
  meta.role = "admin";
  meta.banned = false;
  localStorage.setItem(metaKey, JSON.stringify(meta));
  
  console.log("Senha do admin 'Nemo' atualizada: [PROTEGIDA]");
}

/* ======= FUN√á√ïES DA INTERFACE ======= */
function hideAllPages() {
  document.getElementById('loginBox').classList.add('hidden');
  document.getElementById('registerBox').classList.add('hidden');
  document.getElementById('painelBox').classList.add('hidden');
  document.getElementById('aiPage').classList.add('hidden');
}

function showLogin() {
  hideAllPages();
  document.getElementById('loginBox').classList.remove('hidden');
  lUser.value = "";
  lPass.value = "";
}

function showRegister() {
  hideAllPages();
  document.getElementById('registerBox').classList.remove('hidden');
  rUser.value = "";
  rPass.value = "";
}

function openPainel() {
  const u = localStorage.getItem("session"); 
  if(!u) return alert("Fa√ßa login primeiro");
  
  hideAllPages(); 
  document.getElementById('painelBox').classList.remove('hidden');
  userName.textContent = u;
  
  const role = localStorage.getItem("role_"+u) || "user";
  userRole.textContent = role;
  
  document.querySelector(".admin").style.display = (u === "Nemo") ? "block" : "none";
  
  document.getElementById('loginBtn').style.display = 'none';
  document.getElementById('registerBtn').style.display = 'none';
  document.getElementById('painelBtn').style.display = 'block';
  document.getElementById('aiBtn').style.display = 'block';
  document.getElementById('logoutBtn').style.display = 'block';
  
  const terminal = document.getElementById('terminal');
  if (terminal) terminal.innerHTML = ""; 
  
  log("Sistema Nemo iniciado");
  log(`Bem-vindo, ${u}`);
  
  if (deviceDetector) {
    const deviceInfo = deviceDetector.getDeviceInfo();
    log(`Dispositivo: ${deviceInfo.type} | OS: ${deviceInfo.os}`);
    log(`Navegador: ${deviceInfo.browser} | Conex√£o: ${deviceInfo.connection}`);
  }
  
  startChart();
}

function openAIPage() {
  const u = localStorage.getItem("session"); 
  if(!u) return alert("Fa√ßa login primeiro");
  
  hideAllPages();
  document.getElementById('aiPage').classList.remove('hidden');
  
  // Inicializar IA se ainda n√£o foi iniciada
  if (!window.nemoAI) {
    window.nemoAI = new NemoAIAssistant();
  }
  
  document.getElementById('loginBtn').style.display = 'none';
  document.getElementById('registerBtn').style.display = 'none';
  document.getElementById('painelBtn').style.display = 'block';
  document.getElementById('aiBtn').style.display = 'block';
  document.getElementById('logoutBtn').style.display = 'block';
  
  setTimeout(() => {
    const chatInput = document.getElementById('chatInput');
    if (chatInput) chatInput.focus();
  }, 300);
}

/* ======= RESTANTE DO C√ìDIGO DO SISTEMA ======= */
let logs=[];
function log(m){
  logs.push(m);
  const terminal = document.getElementById('terminal');
  if (terminal) {
    terminal.innerHTML += `<span>> ${m}</span><br>`;
    terminal.scrollTop = terminal.scrollHeight;
  }
}

async function register(){
  if(!rUser.value||!rPass.value) return alert("Campos vazios");
  const username = rUser.value.trim();
  
  if(localStorage.getItem("user_"+username)) return alert("Usu√°rio j√° existe");
  
  const passHash = await hash(rPass.value);
  localStorage.setItem("user_"+username, passHash);
  
  const role = "user";
  localStorage.setItem("role_"+username, role);
  
  const ua = navigator.userAgent;
  const createdAt = new Date().toISOString();
  const ip = await getIP().catch(()=>"127.0.0.1");
  const meta = {
    role, 
    createdAt, 
    createdIP: ip, 
    createdUA: ua, 
    banned: false, 
    logins: [],
    deviceInfo: deviceDetector ? deviceDetector.getDeviceInfo() : null
  };
  localStorage.setItem("meta_"+username, JSON.stringify(meta));
  
  alert("Conta criada com sucesso!"); 
  showLogin();
}

async function login(){
  const username = lUser.value.trim();
  const password = lPass.value;
  
  if(!username || !password) return alert("Preencha todos os campos");
  
  const storedHash = localStorage.getItem("user_"+username);
  if(!storedHash) return alert("Usu√°rio n√£o encontrado");
  
  const inputHash = await hash(password);
  
  if(storedHash === inputHash){
    const metaKey = "meta_"+username;
    const meta = JSON.parse(localStorage.getItem(metaKey) || '{}');
    if(meta.banned) return alert('Conta banida');
    
    const ip = await getIP().catch(()=>"127.0.0.1");
    const entry = {
      at: new Date().toISOString(), 
      ip: ip, 
      ua: navigator.userAgent,
      deviceInfo: deviceDetector ? deviceDetector.getDeviceInfo() : null
    };
    meta.logins = meta.logins || [];
    meta.logins.push(entry);
    localStorage.setItem(metaKey, JSON.stringify(meta));
    
    localStorage.setItem("session", username);
    openPainel();
  } else {
    alert("Senha incorreta");
  }
}

function logout(){
  localStorage.removeItem("session");
  document.getElementById('loginBtn').style.display = 'block';
  document.getElementById('registerBtn').style.display = 'block';
  document.getElementById('painelBtn').style.display = 'none';
  document.getElementById('aiBtn').style.display = 'none';
  document.getElementById('logoutBtn').style.display = 'none';
  showLogin();
}

/* ======= MODAIS ======= */
function openModal(t){
  modal.style.display = "flex";
  modalTitle.textContent = t.toUpperCase();
  
  if(t === "scanner") modalBody.innerHTML = `<button onclick="scan()" class="pulse">Iniciar Scan</button>`;
  if(t === "network") modalBody.innerHTML = `<button onclick="ping()">Testar Ping</button>`;
  if(t === "tools") modalBody.innerHTML = `<button onclick="gen()">Gerar Senha Segura</button>`;
  if(t === "config") modalBody.innerHTML = `<button onclick="toggle()">Alternar Tema</button>`;
  
  if(t === "admin"){
    const current = localStorage.getItem('session');
    if(current !== 'Nemo'){
      modalBody.innerHTML = `<p style="color:var(--primary-light); padding: 20px; text-align: center;">Acesso restrito ao administrador</p>`;
      return;
    }
    modalBody.innerHTML = `<div id="adminContainer"></div>`;
    renderAdmin();
  }
}

function closeModal(){
  modal.style.display = "none";
  modalBody.innerHTML = "";
}

/* ======= A√á√ïES ======= */
function scan(){
  log("Iniciando scan de portas...");
  [21,22,80,443].forEach((p,i)=>setTimeout(()=>{
    const status = Math.random()>.5?"ABERTA":"FECHADA";
    log(`Porta ${p}: ${status}`);
  },i*300))
}

function ping(){
  log("Enviando ping...");
  setTimeout(()=>{
    const latency = (20+Math.random()*80).toFixed(0);
    log(`Ping: ${latency}ms`);
  },500)
}

async function gen(){
  const p = Math.random().toString(36).slice(-10);
  log("Gerando senha segura...");
  setTimeout(async ()=>{
    log(`Senha: ${p}`);
    log(`SHA256: ${await hash(p)}`);
  },300)
}

function toggle(){
  const root = document.documentElement;
  const currentPrimary = getComputedStyle(root).getPropertyValue("--primary").trim();
  
  if(currentPrimary === "#b00000"){
    root.style.setProperty("--primary", "#00cc88");
    root.style.setProperty("--primary-light", "#33ffaa");
    log("Tema alterado: Modo Verde");
  } else if(currentPrimary === "#00cc88"){
    root.style.setProperty("--primary", "#ffaa00");
    root.style.setProperty("--primary-light", "#ffcc44");
    log("Tema alterado: Modo Laranja");
  } else {
    root.style.setProperty("--primary", "#b00000");
    root.style.setProperty("--primary-light", "#ff3333");
    log("Tema alterado: Modo Vermelho (Padr√£o)");
  }
}

async function getIP(){
  try{
    const res = await fetch('https://api.ipify.org?format=json');
    if(!res.ok) throw new Error('Erro na requisi√ß√£o');
    const j = await res.json();
    return j.ip;
  }catch(e){
    return "127.0.0.1";
  }
}

/* ======= CHART ======= */
let ctx = document.getElementById("chart").getContext("2d");
let data = [];

function startChart(){
  data = []; 
  setInterval(()=>{
    data.push(Math.random()*100); 
    if(data.length > 20) data.shift();
    
    const chartCanvas = document.getElementById("chart");
    if (!chartCanvas) return;
    
    ctx.clearRect(0,0,chartCanvas.width,chartCanvas.height);
    
    const gradient = ctx.createLinearGradient(0, 0, chartCanvas.width, 0);
    gradient.addColorStop(0, getComputedStyle(document.documentElement).getPropertyValue("--primary"));
    gradient.addColorStop(1, getComputedStyle(document.documentElement).getPropertyValue("--primary-light"));
    
    ctx.strokeStyle = gradient;
    ctx.lineWidth = 2;
    ctx.beginPath();
    data.forEach((v,i)=>ctx.lineTo(i*(chartCanvas.width/20),chartCanvas.height-v));
    ctx.stroke();
    
    ctx.fillStyle = gradient;
    data.forEach((v,i)=>{
      ctx.beginPath();
      ctx.arc(i*(chartCanvas.width/20),chartCanvas.height-v,3,0,Math.PI*2);
      ctx.fill();
    });
  },1000);
}

/* ======= INICIALIZA√á√ÉO DA P√ÅGINA ======= */
window.onload = async function() {
  await initializeSystem();
  
  if(localStorage.getItem("session")) {
    openPainel();
  } else {
    document.getElementById('loginBtn').style.display = 'block';
    document.getElementById('registerBtn').style.display = 'block';
    document.getElementById('painelBtn').style.display = 'none';
    document.getElementById('aiBtn').style.display = 'none';
    document.getElementById('logoutBtn').style.display = 'none';
    showLogin();
  }
};

window.addEventListener('resize', () => {
  if (deviceDetector) {
    deviceDetector.detectScreen();
  }
  
  if (window.innerWidth > 768) {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    if (sidebar && overlay) {
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    }
  }
});
</script>
</body>
</html>
