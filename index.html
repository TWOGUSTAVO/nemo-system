<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Nemo System ‚Äî Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:monospace}
:root{--red:#b00000;--dark:#050505;--gray:#777}
body{background:var(--dark);color:#fff;height:100vh;overflow:hidden}
header{height:60px;border-bottom:1px solid var(--red);display:flex;justify-content:space-between;align-items:center;padding:0 20px}
header h1{color:var(--red);letter-spacing:2px}
header img{width:40px;filter:grayscale(100%)}
.wrapper{display:flex;height:calc(100vh - 60px)}
.sidebar{width:220px;border-right:1px solid var(--red);padding:15px}
.sidebar button{width:100%;background:transparent;border:1px solid var(--red);color:#fff;padding:10px;margin-bottom:10px;cursor:pointer}
.sidebar button:hover{background:var(--red);box-shadow:0 0 10px var(--red)}
.main{flex:1;padding:20px;overflow:auto}
.box{max-width:400px;border:1px solid var(--red);padding:20px}
.box input{width:100%;padding:10px;margin:10px 0;background:#000;border:1px solid var(--gray);color:#fff}
.box button{width:100%;padding:10px;background:var(--red);border:none;cursor:pointer}
.terminal{background:#000;border:1px solid var(--red);padding:15px;margin-bottom:15px;height:140px;overflow:auto}
.terminal span{color:var(--red)}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px}
.card{border:1px solid var(--red);padding:15px}
.card button{width:100%;margin-top:10px;padding:8px;background:#000;border:1px solid var(--red);color:#fff;cursor:pointer}
.card button:hover{background:var(--red);box-shadow:0 0 15px var(--red)}
.hidden{display:none}

/* MODAL */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center}
.modal .content{background:#000;border:1px solid var(--red);padding:20px;width:420px}
.modal h3{color:var(--red);margin-bottom:10px}
.modal button{margin-top:10px}

/* CHART */
#chart{background:#000;border:1px solid var(--red);margin-top:10px}

footer{text-align:center;color:#444;padding:10px}
</style>
</head>

<body>
<header>
  <h1>NEMO SYSTEM</h1>
  <img src="https://cdn-icons-png.flaticon.com/512/924/924915.png">
</header>

<div class="wrapper">
  <div class="sidebar">
    <button id="loginBtn" onclick="showLogin()">Login</button>
    <button id="registerBtn" onclick="showRegister()">Registrar</button>
    <button id="painelBtn" onclick="openPainel()">Painel Nemo</button>
    <button id="logoutBtn" onclick="logout()">Logout</button>
  </div>

  <div class="main">
    <div id="loginBox" class="box">
      <h2>Login</h2>
      <input id="lUser" placeholder="Usu√°rio">
      <input id="lPass" type="password" placeholder="Senha">
      <button onclick="login()">Entrar</button>
    </div>

    <div id="registerBox" class="box hidden">
      <h2>Registro</h2>
      <input id="rUser" placeholder="Usu√°rio">
      <input id="rPass" type="password" placeholder="Senha">
      <button onclick="register()">Criar Conta</button>
    </div>

    <div id="painelBox" class="hidden">
      <div class="terminal" id="terminal"></div>
      <p>Usu√°rio: <b><span id="userName"></span></b> | Role: <b><span id="userRole"></span></b></p>

      <canvas id="chart" width="400" height="120"></canvas>

      <div class="cards">
        <div class="card"><h3>üîç Scanner</h3><button onclick="openModal('scanner')">Abrir</button></div>
        <div class="card"><h3>üì° Network</h3><button onclick="openModal('network')">Abrir</button></div>
        <div class="card"><h3>üõ† Tools</h3><button onclick="openModal('tools')">Abrir</button></div>
        <div class="card"><h3>‚öô Config</h3><button onclick="openModal('config')">Abrir</button></div>
        <div class="card admin"><h3>üëë Admin</h3><button onclick="openModal('admin')">Abrir</button></div>
      </div>

      <br>
      <button onclick="exportLogs()">üìÅ Exportar Logs (CSV)</button>
    </div>
  </div>
</div>

<footer>Nemo System ¬© 2026</footer>

<!-- MODAL -->
<div id="modal" class="modal">
  <div class="content">
    <h3 id="modalTitle"></h3>
    <div id="modalBody"></div>
    <button onclick="closeModal()">Fechar</button>
  </div>
</div>

<script>
/* ======= CRIPTO ======= */
async function hash(t){const e=new TextEncoder().encode(t),b=await crypto.subtle.digest("SHA-256",e);return[...new Uint8Array(b)].map(x=>x.toString(16).padStart(2,"0")).join("")}

/* ======= LOG ======= */
let logs=[];
function log(m){logs.push(m);terminal.innerHTML+=`<span>> ${m}</span><br>`;terminal.scrollTop=terminal.scrollHeight}

/* ======= AUTH ======= */
async function register(){
  if(!rUser.value||!rPass.value) return alert("Campos vazios");
  const username = rUser.value.trim();
  if(username === "Nemo") return alert("Usu√°rio reservado");
  if(localStorage.getItem("user_"+username)) return alert("Usu√°rio j√° existe");
  const passHash = await hash(rPass.value);
  localStorage.setItem("user_"+username, passHash);
  const role = "user"; // Sempre "user", exceto se for o dev que cria manualmente
  localStorage.setItem("role_"+username, role);
  const ua = navigator.userAgent;
  const createdAt = new Date().toISOString();
  const ip = await getIP().catch(()=>undefined);
  const meta = {role, createdAt, createdIP: ip||"‚Äî", createdUA: ua, banned: false, logins: []};
  localStorage.setItem("meta_"+username, JSON.stringify(meta));
  alert("Conta criada"); showLogin();
}
async function login(){
  const username = lUser.value.trim();
  const s = localStorage.getItem("user_"+username);
  if(!s) return alert("Acesso negado");
  if(s===await hash(lPass.value)){
    const metaKey = "meta_"+username;
    const meta = JSON.parse(localStorage.getItem(metaKey) || '{}');
    if(meta.banned) return alert('Conta banida');
    const ip = await getIP().catch(()=>undefined);
    const entry = {at: new Date().toISOString(), ip: ip||"‚Äî", ua: navigator.userAgent};
    meta.logins = meta.logins || [];
    meta.logins.push(entry);
    localStorage.setItem(metaKey, JSON.stringify(meta));
    localStorage.setItem("session",username);
    openPainel();
  } else alert("Acesso negado");
}
function logout(){
  localStorage.removeItem("session");
  document.getElementById('loginBtn').style.display = 'block';
  document.getElementById('registerBtn').style.display = 'block';
  document.getElementById('painelBtn').style.display = 'none';
  document.getElementById('logoutBtn').style.display = 'none';
  showLogin();
}

/* ======= UI ======= */
function hideAll(){loginBox.classList.add("hidden");registerBox.classList.add("hidden");painelBox.classList.add("hidden")}
function showLogin(){hideAll();loginBox.classList.remove("hidden")}
function showRegister(){hideAll();registerBox.classList.remove("hidden")}

function openPainel(){
  const u=localStorage.getItem("session"); if(!u) return alert("Fa√ßa login");
  hideAll(); painelBox.classList.remove("hidden");
  userName.textContent=u;
  const role=localStorage.getItem("role_"+u)||"user";
  userRole.textContent=role;
  // Mostrar painel admin apenas para o dono do site: usu√°rio 'Nemo'
  document.querySelector(".admin").style.display = (u === "Nemo") ? "block" : "none";
  // Esconder bot√µes de login e registrar, mostrar painel e logout
  document.getElementById('loginBtn').style.display = 'none';
  document.getElementById('registerBtn').style.display = 'none';
  document.getElementById('painelBtn').style.display = 'block';
  document.getElementById('logoutBtn').style.display = 'block';
  terminal.innerHTML=""; log("Sistema iniciado"); startChart();
}

/* ======= MODAIS ======= */
function openModal(t){
  modal.style.display="flex";
  modalTitle.textContent=t.toUpperCase();
  if(t==="scanner") modalBody.innerHTML=`<button onclick="scan()">Scan</button>`;
  if(t==="network") modalBody.innerHTML=`<button onclick="ping()">Ping</button>`;
  if(t==="tools") modalBody.innerHTML=`<button onclick="gen()">Gerar Senha</button>`;
  if(t==="config") modalBody.innerHTML=`<button onclick="toggle()">Trocar Tema</button>`;
  if(t==="admin"){
    const current = localStorage.getItem('session');
    if(current !== 'Nemo'){
      modalBody.innerHTML = `<p style="color:var(--red)">Acesso negado</p>`;
      return;
    }
    modalBody.innerHTML = `<div id="adminContainer"></div>`;
    renderAdmin();
  }
}
function closeModal(){modal.style.display="none";modalBody.innerHTML=""}

/* ======= A√á√ïES ======= */
function scan(){[21,22,80,443].forEach((p,i)=>setTimeout(()=>log("Porta "+p+": "+(Math.random()>.5?"ABERTA":"FECHADA")),i*300))}
function ping(){log("Ping: "+(20+Math.random()*80).toFixed(0)+"ms")}
async function gen(){const p=Math.random().toString(36).slice(-10);log("Senha: "+p);log("SHA256: "+await hash(p))}
function toggle(){const c=getComputedStyle(document.documentElement).getPropertyValue("--red").trim();document.documentElement.style.setProperty("--red",c==="#b00000"?"#00ff88":"#b00000");log("Tema alterado")}
function resetSys(){if(confirm("Resetar tudo?")){localStorage.clear();location.reload()}}

/* ======= EXPORT ======= */
async function getIP(){
  try{
    const res = await fetch('https://api.ipify.org?format=json');
    if(!res.ok) throw 0;
    const j = await res.json();
    return j.ip;
  }catch(e){
    return undefined;
  }
}

function getAllUsers(){
  const users = [];
  for(let i=0;i<localStorage.length;i++){
    const k = localStorage.key(i);
    if(k && k.startsWith('user_')){
      const username = k.slice(5);
      const meta = JSON.parse(localStorage.getItem('meta_'+username) || '{}');
      const role = localStorage.getItem('role_'+username) || meta.role || 'user';
      users.push({username, role, meta});
    }
  }
  return users.sort((a,b)=>a.username.localeCompare(b.username));
}

function renderAdmin(){
  const container = document.getElementById('adminContainer');
  const users = getAllUsers();
  let html = `<div style="max-height:320px;overflow:auto"><table style="width:100%;border-collapse:collapse">`;
  html += `<tr style="text-align:left;color:var(--red)"><th>Usu√°rio</th><th>Role</th><th>Criado</th><th>IP</th><th>Ban</th><th>A√ß√µes</th></tr>`;
  users.forEach(u=>{
    const created = u.meta.createdAt||'‚Äî';
    const ip = u.meta.createdIP||'‚Äî';
    const banned = u.meta.banned? 'Sim':'N√£o';
    html += `<tr><td>${u.username}</td><td>${u.role}</td><td>${created}</td><td>${ip}</td><td>${banned}</td><td>`+
            `<button data-user="${u.username}" data-action="view">Ver</button> `+
            `<button data-user="${u.username}" data-action="toggle">${u.meta.banned? 'Desbanir':'Banir'}</button>`+
            `</td></tr>`;
  });
  html += `</table></div>`;
  html += `<div style="margin-top:8px"><button onclick="modalBody.innerHTML='';modalTitle.textContent='ADMIN';modalBody.innerHTML='<button onclick=&quot;resetSys()&quot;>Reset Sistema</button>'">Reset Sistema</button></div>`;
  container.innerHTML = html;
  container.querySelectorAll('button[data-user]').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const u = e.currentTarget.getAttribute('data-user');
      const a = e.currentTarget.getAttribute('data-action');
      if(a==='view') viewUser(u);
      if(a==='toggle') toggleBan(u);
    });
  });
}

function viewUser(username){
  const meta = JSON.parse(localStorage.getItem('meta_'+username) || '{}');
  const role = localStorage.getItem('role_'+username) || meta.role || 'user';
  let html = `<h4>${username}</h4><p>Role: ${role}</p><p>Criado: ${meta.createdAt||'‚Äî'}</p><p>IP: ${meta.createdIP||'‚Äî'}</p><p>UA: <small>${meta.createdUA||'‚Äî'}</small></p>`;
  html += `<h5>Logins:</h5>`;
  if(meta.logins && meta.logins.length){
    html += `<div style="max-height:200px;overflow:auto"><ul>` + meta.logins.slice().reverse().map(l=>`<li>${l.at} ‚Äî ${l.ip||'‚Äî'}</li>`).join('') + `</ul></div>`;
  } else html += `<p>Sem logins</p>`;
  html += `<div style="margin-top:8px"><button onclick="renderAdmin()">Voltar</button> <button onclick="toggleBan('${username}')">${meta.banned? 'Desbanir':'Banir'}</button></div>`;
  modalBody.innerHTML = html;
}

function toggleBan(username){
  const key = 'meta_'+username;
  const meta = JSON.parse(localStorage.getItem(key) || '{}');
  meta.banned = !meta.banned;
  localStorage.setItem(key, JSON.stringify(meta));
  log(`Usu√°rio ${username} ${meta.banned? 'banido':'desbanido'}`);
  renderAdmin();
}

function exportLogs(){
  const csv=logs.join("\n");
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download="logs.csv"; a.click();
}

/* ======= CHART ======= */
let ctx=document.getElementById("chart").getContext("2d"),data=[];
function startChart(){
  data=[]; setInterval(()=>{
    data.push(Math.random()*100); if(data.length>20) data.shift();
    ctx.clearRect(0,0,400,120);
    ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue("--red");
    ctx.beginPath();
    data.forEach((v,i)=>ctx.lineTo(i*20,120-v));
    ctx.stroke();
  },1000);
}

/* AUTO LOGIN */
if(localStorage.getItem("session")) {
  openPainel();
} else {
  document.getElementById('loginBtn').style.display = 'block';
  document.getElementById('registerBtn').style.display = 'block';
  document.getElementById('painelBtn').style.display = 'none';
  document.getElementById('logoutBtn').style.display = 'none';
  showLogin();
}
</script>
</body>
</html>
