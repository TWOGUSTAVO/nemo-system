<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Nemo System ‚Äî Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* ======= VARI√ÅVEIS CSS ======= */
:root {
  --primary: #b00000;
  --primary-light: #ff3333;
  --dark: #0a0a0a;
  --dark-secondary: #121212;
  --gray: #777;
  --gray-light: #aaa;
  --success: #00cc88;
  --warning: #ffaa00;
  --card-bg: rgba(30, 30, 30, 0.7);
  --modal-bg: rgba(10, 10, 10, 0.95);
  --shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
  --shadow-glow: 0 0 15px rgba(176, 0, 0, 0.3);
  --gradient-primary: linear-gradient(135deg, #b00000 0%, #ff3333 100%);
  --gradient-dark: linear-gradient(135deg, #050505 0%, #1a1a1a 100%);
}

/* ======= RESET & BASE ======= */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
  background: var(--dark-secondary);
  color: #fff;
  min-height: 100vh;
  overflow-x: hidden;
  background-image: 
    radial-gradient(circle at 10% 20%, rgba(176, 0, 0, 0.05) 0%, transparent 20%),
    radial-gradient(circle at 90% 80%, rgba(176, 0, 0, 0.05) 0%, transparent 20%);
}

/* ======= BADGE DE DISPOSITIVO ======= */
.device-badge {
  position: fixed;
  top: 10px;
  right: 10px;
  background: var(--primary);
  color: white;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.7rem;
  font-weight: 600;
  z-index: 1001;
  box-shadow: var(--shadow);
  display: flex;
  align-items: center;
  gap: 5px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.device-badge::before {
  content: '';
  display: inline-block;
  width: 8px;
  height: 8px;
  background: #00ff00;
  border-radius: 50%;
  animation: pulse 2s infinite;
}

/* ======= HEADER ======= */
header {
  height: 70px;
  background: var(--dark);
  border-bottom: 1px solid rgba(176, 0, 0, 0.3);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 25px;
  box-shadow: var(--shadow);
  position: sticky;
  top: 0;
  z-index: 1000;
}

header h1 {
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-weight: 700;
  letter-spacing: 1.5px;
  font-size: 1.8rem;
  text-shadow: 0 0 10px rgba(176, 0, 0, 0.2);
}

.logo-container {
  display: flex;
  align-items: center;
  gap: 15px;
}

.device-info {
  font-size: 0.7rem;
  color: var(--gray-light);
  background: rgba(255, 255, 255, 0.05);
  padding: 4px 8px;
  border-radius: 8px;
  display: none;
}

header img {
  width: 45px;
  filter: invert(15%) sepia(100%) saturate(5000%) hue-rotate(0deg);
  transition: transform 0.3s ease;
}

header img:hover {
  transform: scale(1.1);
}

/* ======= MENU HAMBURGUER (MOBILE) ======= */
.menu-toggle {
  display: none;
  background: transparent;
  border: none;
  color: white;
  font-size: 1.5rem;
  cursor: pointer;
  padding: 10px;
}

/* ======= LAYOUT PRINCIPAL ======= */
.wrapper {
  display: flex;
  min-height: calc(100vh - 70px);
  padding: 15px;
  gap: 15px;
}

/* ======= SIDEBAR ======= */
.sidebar {
  width: 240px;
  background: var(--dark);
  border-radius: 15px;
  padding: 20px 15px;
  box-shadow: var(--shadow);
  border: 1px solid rgba(176, 0, 0, 0.2);
  display: flex;
  flex-direction: column;
  gap: 12px;
  transition: transform 0.3s ease;
}

.sidebar.active {
  transform: translateX(0);
}

.sidebar button {
  background: transparent;
  border: 1px solid var(--primary);
  color: #fff;
  padding: 14px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: all 0.3s ease;
  text-align: left;
  display: flex;
  align-items: center;
  gap: 10px;
}

.sidebar button:before {
  content: '';
  display: inline-block;
  width: 8px;
  height: 8px;
  background: var(--primary);
  border-radius: 50%;
}

.sidebar button:hover {
  background: var(--gradient-primary);
  transform: translateX(5px);
  box-shadow: var(--shadow-glow);
}

/* ======= √ÅREA PRINCIPAL ======= */
.main {
  flex: 1;
  background: var(--dark);
  border-radius: 15px;
  padding: 25px;
  overflow: auto;
  box-shadow: var(--shadow);
  border: 1px solid rgba(176, 0, 0, 0.2);
}

/* ======= BOX DE LOGIN/REGISTRO ======= */
.box {
  max-width: 420px;
  margin: 0 auto;
  background: var(--card-bg);
  border: 1px solid rgba(176, 0, 0, 0.3);
  padding: 30px;
  border-radius: 15px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(5px);
}

.box h2 {
  color: #fff;
  margin-bottom: 25px;
  text-align: center;
  font-size: 1.8rem;
  font-weight: 600;
  letter-spacing: 1px;
}

.box input {
  width: 100%;
  padding: 14px 18px;
  margin: 12px 0;
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: #fff;
  border-radius: 10px;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.box input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 2px rgba(176, 0, 0, 0.2);
}

.box button {
  width: 100%;
  padding: 14px;
  background: var(--gradient-primary);
  border: none;
  border-radius: 10px;
  cursor: pointer;
  color: white;
  font-weight: 600;
  font-size: 1rem;
  letter-spacing: 0.5px;
  margin-top: 10px;
  transition: all 0.3s ease;
}

.box button:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-glow);
}

/* ======= TERMINAL ======= */
.terminal {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(176, 0, 0, 0.3);
  padding: 20px;
  margin-bottom: 20px;
  min-height: 160px;
  max-height: 200px;
  overflow: auto;
  border-radius: 10px;
  font-family: 'Courier New', monospace;
  font-size: 0.9rem;
  box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
}

.terminal span {
  color: var(--primary-light);
  display: block;
  margin-bottom: 5px;
  word-break: break-word;
}

/* ======= INFO DO DISPOSITIVO NO TERMINAL ======= */
.device-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 10px;
  margin-bottom: 20px;
  background: rgba(176, 0, 0, 0.1);
  padding: 15px;
  border-radius: 10px;
  border-left: 4px solid var(--primary);
}

.device-stat {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.device-stat-label {
  font-size: 0.8rem;
  color: var(--gray-light);
}

.device-stat-value {
  font-weight: 600;
  color: var(--primary-light);
  font-size: 0.9rem;
}

/* ======= CARDS DO PAINEL ======= */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 20px;
  margin-top: 25px;
}

.card {
  background: var(--card-bg);
  border: 1px solid rgba(176, 0, 0, 0.2);
  padding: 20px;
  border-radius: 15px;
  transition: all 0.3s ease;
  backdrop-filter: blur(5px);
}

.card:hover {
  transform: translateY(-5px);
  border-color: var(--primary);
  box-shadow: var(--shadow-glow);
}

.card h3 {
  color: #fff;
  margin-bottom: 15px;
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card button {
  width: 100%;
  margin-top: 15px;
  padding: 12px;
  background: transparent;
  border: 1px solid var(--primary);
  color: #fff;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.3s ease;
}

.card button:hover {
  background: var(--gradient-primary);
  box-shadow: var(--shadow-glow);
}

/* ======= INFO DO USU√ÅRIO ======= */
#painelBox > p {
  background: rgba(176, 0, 0, 0.1);
  padding: 12px 20px;
  border-radius: 10px;
  margin-bottom: 20px;
  border-left: 4px solid var(--primary);
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  align-items: center;
}

#userName, #userRole {
  color: var(--primary-light);
}

/* ======= BOT√ÉO EXPORTAR ======= */
#painelBox > button:last-child {
  background: var(--gradient-dark);
  border: 1px solid var(--gray);
  color: #fff;
  padding: 14px 25px;
  border-radius: 10px;
  cursor: pointer;
  margin-top: 25px;
  font-weight: 500;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  width: 100%;
  max-width: 300px;
}

#painelBox > button:last-child:hover {
  border-color: var(--primary);
  background: rgba(176, 0, 0, 0.1);
  box-shadow: var(--shadow-glow);
}

/* ======= MODAL ======= */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  display: none;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(5px);
  z-index: 2000;
  padding: 20px;
}

.modal .content {
  background: var(--modal-bg);
  border: 1px solid var(--primary);
  padding: 25px;
  width: 500px;
  max-width: 100%;
  border-radius: 15px;
  box-shadow: var(--shadow-glow);
  animation: modalAppear 0.3s ease-out;
  max-height: 90vh;
  overflow-y: auto;
}

@keyframes modalAppear {
  from {
    opacity: 0;
    transform: translateY(-30px) scale(0.9);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.modal h3 {
  color: var(--primary-light);
  margin-bottom: 20px;
  font-size: 1.5rem;
  border-bottom: 1px solid rgba(176, 0, 0, 0.3);
  padding-bottom: 10px;
}

.modal button {
  background: var(--gradient-primary);
  border: none;
  color: white;
  padding: 12px 24px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 500;
  margin-top: 20px;
  transition: all 0.3s ease;
  width: 100%;
}

.modal button:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-glow);
}

/* ======= CHART ======= */
#chart {
  background: rgba(0, 0, 0, 0.5);
  border: 1px solid rgba(176, 0, 0, 0.3);
  margin-top: 20px;
  border-radius: 10px;
  width: 100%;
  max-width: 100%;
}

/* ======= FOOTER ======= */
footer {
  text-align: center;
  color: var(--gray);
  padding: 15px;
  font-size: 0.9rem;
  border-top: 1px solid rgba(176, 0, 0, 0.1);
  background: var(--dark);
  margin-top: auto;
}

/* ======= UTILIT√ÅRIOS ======= */
.hidden {
  display: none !important;
}

.admin {
  border: 1px solid var(--warning);
}

.admin h3 {
  color: var(--warning) !important;
}

.admin button {
  border-color: var(--warning) !important;
}

.admin button:hover {
  background: linear-gradient(135deg, #ffaa00 0%, #ffcc00 100%) !important;
}

/* ======= ANIMA√á√ïES ======= */
@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0.4); }
  70% { box-shadow: 0 0 0 10px rgba(0, 255, 0, 0); }
  100% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0); }
}

@keyframes slideIn {
  from {
    transform: translateX(-100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.pulse {
  animation: pulse 2s infinite;
}

/* ======= SCROLLBAR PERSONALIZADA ======= */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.3);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--primary-light);
}

/* ======= RESPONSIVIDADE - TABLET ======= */
@media (max-width: 1024px) {
  .wrapper {
    flex-direction: column;
    height: auto;
    min-height: calc(100vh - 70px);
  }
  
  .sidebar {
    width: 100%;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
    padding: 15px;
  }
  
  .sidebar button {
    flex: 1;
    min-width: 160px;
    justify-content: center;
    padding: 12px;
  }
  
  .cards {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  }
  
  .device-info {
    display: block;
  }
}

/* ======= RESPONSIVIDADE - MOBILE ======= */
@media (max-width: 768px) {
  header {
    padding: 0 15px;
    height: 60px;
  }
  
  header h1 {
    font-size: 1.4rem;
  }
  
  .logo-container h1 {
    font-size: 1.2rem;
  }
  
  .menu-toggle {
    display: block;
  }
  
  .sidebar {
    position: fixed;
    top: 70px;
    left: 0;
    width: 280px;
    height: calc(100vh - 70px);
    transform: translateX(-100%);
    z-index: 999;
    padding: 20px;
    flex-direction: column;
    overflow-y: auto;
  }
  
  .sidebar.active {
    transform: translateX(0);
  }
  
  .sidebar-overlay {
    position: fixed;
    top: 70px;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
    z-index: 998;
    display: none;
  }
  
  .sidebar-overlay.active {
    display: block;
  }
  
  .sidebar button {
    min-width: 100%;
    justify-content: flex-start;
  }
  
  .main {
    padding: 15px;
  }
  
  .box {
    padding: 20px;
  }
  
  .cards {
    grid-template-columns: 1fr;
  }
  
  .device-badge {
    top: 75px;
    right: 15px;
    font-size: 0.6rem;
    padding: 4px 8px;
  }
  
  .modal .content {
    padding: 20px;
    width: 95%;
  }
  
  #chart {
    height: 100px;
  }
  
  .terminal {
    min-height: 120px;
    max-height: 150px;
    font-size: 0.8rem;
    padding: 15px;
  }
  
  .device-stats {
    grid-template-columns: 1fr;
    padding: 10px;
    gap: 8px;
  }
  
  #painelBox > p {
    flex-direction: column;
    align-items: flex-start;
    gap: 5px;
    padding: 10px 15px;
  }
}

/* ======= RESPONSIVIDADE - SMALL MOBILE ======= */
@media (max-width: 480px) {
  header {
    padding: 0 10px;
  }
  
  header h1 {
    font-size: 1.2rem;
  }
  
  header img {
    width: 35px;
  }
  
  .box {
    padding: 15px;
    margin: 0 10px;
  }
  
  .box h2 {
    font-size: 1.5rem;
  }
  
  .box input {
    padding: 12px 15px;
  }
  
  .card {
    padding: 15px;
  }
  
  .card h3 {
    font-size: 1.1rem;
  }
  
  .device-badge {
    font-size: 0.55rem;
    padding: 3px 6px;
  }
  
  .wrapper {
    padding: 10px;
  }
  
  .main {
    padding: 10px;
  }
}

/* ======= DARK OVERLAY FOR MOBILE MENU ======= */
.overlay {
  display: none;
  position: fixed;
  top: 70px;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(5px);
  z-index: 998;
}

.overlay.active {
  display: block;
}

/* ======= TOUCH-FRIENDLY ELEMENTS ======= */
@media (hover: none) and (pointer: coarse) {
  .sidebar button,
  .card button,
  .box button,
  .modal button {
    min-height: 44px;
  }
  
  input, button {
    font-size: 16px !important; /* Prevents zoom on iOS */
  }
}
</style>
</head>

<body>
<header>
  <div class="logo-container">
    <h1>NEMO SYSTEM</h1>
    <div class="device-info" id="deviceInfo"></div>
  </div>
  <button class="menu-toggle" id="menuToggle">‚ò∞</button>
  <img src="https://cdn-icons-png.flaticon.com/512/924/924915.png" alt="Logo Nemo">
</header>

<div class="device-badge" id="deviceBadge">
  <span id="deviceType">Carregando...</span>
</div>

<div class="wrapper">
  <div class="overlay" id="overlay"></div>
  <div class="sidebar" id="sidebar">
    <button id="loginBtn" onclick="showLogin()">üîê Login</button>
    <button id="registerBtn" onclick="showRegister()">üìù Registrar</button>
    <button id="painelBtn" onclick="openPainel()">üñ•Ô∏è Painel Nemo</button>
    <button id="logoutBtn" onclick="logout()">üö™ Logout</button>
  </div>

  <div class="main">
    <div id="loginBox" class="box">
      <h2>Login</h2>
      <input id="lUser" placeholder="Usu√°rio">
      <input id="lPass" type="password" placeholder="Senha">
      <button onclick="login()">Entrar</button>
    </div>

    <div id="registerBox" class="box hidden">
      <h2>Registro</h2>
      <input id="rUser" placeholder="Usu√°rio">
      <input id="rPass" type="password" placeholder="Senha">
      <button onclick="register()">Criar Conta</button>
    </div>

    <div id="painelBox" class="hidden">
      <div class="terminal" id="terminal"></div>
      
      <div class="device-stats" id="deviceStats">
        <!-- Device info will be populated here -->
      </div>
      
      <p>Usu√°rio: <b><span id="userName"></span></b> | Role: <b><span id="userRole"></span></b></p>

      <canvas id="chart" width="400" height="120"></canvas>

      <div class="cards">
        <div class="card"><h3>üîç Scanner</h3><button onclick="openModal('scanner')">Abrir</button></div>
        <div class="card"><h3>üì° Network</h3><button onclick="openModal('network')">Abrir</button></div>
        <div class="card"><h3>üõ† Tools</h3><button onclick="openModal('tools')">Abrir</button></div>
        <div class="card"><h3>‚öô Config</h3><button onclick="openModal('config')">Abrir</button></div>
        <div class="card admin"><h3>üëë Admin</h3><button onclick="openModal('admin')">Abrir</button></div>
      </div>

      <br>
      <button onclick="exportLogs()">üìÅ Exportar Logs (CSV)</button>
    </div>
  </div>
</div>

<footer>Nemo System ¬© 2026 | <span id="connectionType">Detectando conex√£o...</span></footer>

<!-- MODAL -->
<div id="modal" class="modal">
  <div class="content">
    <h3 id="modalTitle"></h3>
    <div id="modalBody"></div>
    <button onclick="closeModal()">Fechar</button>
  </div>
</div>

<script>
/* ======= DETEC√á√ÉO DE DISPOSITIVO ======= */
class DeviceDetector {
  constructor() {
    this.deviceInfo = {
      type: 'desktop',
      os: 'Unknown',
      browser: 'Unknown',
      screenSize: 'Unknown',
      orientation: 'portrait',
      touch: false,
      connection: 'Unknown',
      platform: 'Unknown',
      language: 'Unknown',
      timezone: 'Unknown'
    };
    this.init();
  }

  init() {
    this.detectDeviceType();
    this.detectOS();
    this.detectBrowser();
    this.detectScreen();
    this.detectTouch();
    this.detectConnection();
    this.detectPlatform();
    this.detectLanguage();
    this.detectTimezone();
    this.updateUI();
  }

  detectDeviceType() {
    const userAgent = navigator.userAgent.toLowerCase();
    const isMobile = /mobile|iphone|ipod|android|blackberry|mini|windows\s+ce|palm|smartphone|webos/i.test(userAgent);
    const isTablet = /tablet|ipad|playbook|silk/i.test(userAgent);
    
    if (isMobile) this.deviceInfo.type = 'mobile';
    else if (isTablet) this.deviceInfo.type = 'tablet';
    else this.deviceInfo.type = 'desktop';
  }

  detectOS() {
    const userAgent = navigator.userAgent;
    if (userAgent.indexOf("Win") !== -1) this.deviceInfo.os = "Windows";
    else if (userAgent.indexOf("Mac") !== -1) this.deviceInfo.os = "macOS";
    else if (userAgent.indexOf("Linux") !== -1) this.deviceInfo.os = "Linux";
    else if (userAgent.indexOf("Android") !== -1) this.deviceInfo.os = "Android";
    else if (userAgent.indexOf("iOS") !== -1 || /iPad|iPhone|iPod/.test(userAgent)) this.deviceInfo.os = "iOS";
    else this.deviceInfo.os = "Unknown OS";
  }

  detectBrowser() {
    const userAgent = navigator.userAgent;
    if (userAgent.indexOf("Chrome") !== -1) this.deviceInfo.browser = "Chrome";
    else if (userAgent.indexOf("Firefox") !== -1) this.deviceInfo.browser = "Firefox";
    else if (userAgent.indexOf("Safari") !== -1) this.deviceInfo.browser = "Safari";
    else if (userAgent.indexOf("Edge") !== -1) this.deviceInfo.browser = "Edge";
    else if (userAgent.indexOf("Opera") !== -1) this.deviceInfo.browser = "Opera";
    else this.deviceInfo.browser = "Unknown Browser";
  }

  detectScreen() {
    this.deviceInfo.screenSize = `${window.screen.width} √ó ${window.screen.height}`;
    this.deviceInfo.orientation = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
    
    // Update on resize
    window.addEventListener('resize', () => {
      this.deviceInfo.screenSize = `${window.screen.width} √ó ${window.screen.height}`;
      this.deviceInfo.orientation = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
      this.updateUI();
    });
    
    // Update on orientation change
    window.addEventListener('orientationchange', () => {
      setTimeout(() => {
        this.deviceInfo.orientation = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
        this.updateUI();
      }, 100);
    });
  }

  detectTouch() {
    this.deviceInfo.touch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
  }

  detectConnection() {
    if (navigator.connection) {
      const connection = navigator.connection;
      this.deviceInfo.connection = connection.effectiveType || 'Unknown';
      
      // Listen for connection changes
      connection.addEventListener('change', () => {
        this.deviceInfo.connection = connection.effectiveType || 'Unknown';
        this.updateUI();
      });
    } else {
      this.deviceInfo.connection = 'Ethernet/WiFi';
    }
  }

  detectPlatform() {
    this.deviceInfo.platform = navigator.platform || 'Unknown';
  }

  detectLanguage() {
    this.deviceInfo.language = navigator.language || 'Unknown';
  }

  detectTimezone() {
    this.deviceInfo.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Unknown';
  }

  updateUI() {
    // Update badge
    const badge = document.getElementById('deviceBadge');
    const deviceType = document.getElementById('deviceType');
    
    if (badge && deviceType) {
      let typeText = '';
      let typeIcon = '';
      
      switch(this.deviceInfo.type) {
        case 'mobile':
          typeText = 'üì± Mobile';
          typeIcon = 'üì±';
          break;
        case 'tablet':
          typeText = 'üìü Tablet';
          typeIcon = 'üìü';
          break;
        default:
          typeText = 'üñ•Ô∏è Desktop';
          typeIcon = 'üñ•Ô∏è';
      }
      
      deviceType.textContent = `${typeIcon} ${typeText} | ${this.deviceInfo.os}`;
      
      // Update connection in footer
      const connectionSpan = document.getElementById('connectionType');
      if (connectionSpan) {
        connectionSpan.textContent = `Conex√£o: ${this.deviceInfo.connection}`;
      }
    }
    
    // Update device info in header (mobile)
    const deviceInfoDiv = document.getElementById('deviceInfo');
    if (deviceInfoDiv) {
      deviceInfoDiv.textContent = `${this.deviceInfo.type} | ${this.deviceInfo.os}`;
    }
    
    // Update device stats in panel
    this.updateDeviceStats();
    
    // Log device info
    if (typeof log === 'function') {
      log(`Dispositivo: ${this.deviceInfo.type} | OS: ${this.deviceInfo.os} | Navegador: ${this.deviceInfo.browser}`);
      log(`Tela: ${this.deviceInfo.screenSize} | Orienta√ß√£o: ${this.deviceInfo.orientation}`);
      log(`Touch: ${this.deviceInfo.touch ? 'Sim' : 'N√£o'} | Conex√£o: ${this.deviceInfo.connection}`);
    }
  }

  updateDeviceStats() {
    const statsContainer = document.getElementById('deviceStats');
    if (!statsContainer) return;
    
    statsContainer.innerHTML = `
      <div class="device-stat">
        <span class="device-stat-label">üì± Dispositivo</span>
        <span class="device-stat-value">${this.deviceInfo.type.toUpperCase()}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">‚öôÔ∏è Sistema</span>
        <span class="device-stat-value">${this.deviceInfo.os}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">üåê Navegador</span>
        <span class="device-stat-value">${this.deviceInfo.browser}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">üìè Resolu√ß√£o</span>
        <span class="device-stat-value">${this.deviceInfo.screenSize}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">üì∂ Conex√£o</span>
        <span class="device-stat-value">${this.deviceInfo.connection}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">üìç Idioma</span>
        <span class="device-stat-value">${this.deviceInfo.language}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">üïê Fuso Hor√°rio</span>
        <span class="device-stat-value">${this.deviceInfo.timezone}</span>
      </div>
      <div class="device-stat">
        <span class="device-stat-label">üëÜ Touch</span>
        <span class="device-stat-value">${this.deviceInfo.touch ? 'Sim' : 'N√£o'}</span>
      </div>
    `;
  }

  getDeviceInfo() {
    return this.deviceInfo;
  }
}

/* ======= GERENCIAMENTO DE MENU MOBILE ======= */
function setupMobileMenu() {
  const menuToggle = document.getElementById('menuToggle');
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  
  if (menuToggle && sidebar) {
    menuToggle.addEventListener('click', () => {
      sidebar.classList.toggle('active');
      overlay.classList.toggle('active');
      document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : '';
    });
    
    overlay.addEventListener('click', () => {
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    });
    
    // Close menu when clicking on a sidebar button
    sidebar.querySelectorAll('button').forEach(button => {
      button.addEventListener('click', () => {
        if (window.innerWidth <= 768) {
          sidebar.classList.remove('active');
          overlay.classList.remove('active');
          document.body.style.overflow = '';
        }
      });
    });
    
    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
      }
    });
  }
}

/* ======= CRIPTO ======= */
async function hash(t){const e=new TextEncoder().encode(t),b=await crypto.subtle.digest("SHA-256",e);return[...new Uint8Array(b)].map(x=>x.toString(16).padStart(2,"0")).join("")}

/* ======= INICIALIZA√á√ÉO DO SISTEMA ======= */
let deviceDetector;
async function initializeSystem() {
  // Inicializa detector de dispositivo
  deviceDetector = new DeviceDetector();
  
  // Configura menu mobile
  setupMobileMenu();
  
  // Verifica se o usu√°rio Nemo j√° existe no sistema
  const nemoExists = localStorage.getItem("user_Nemo");
  
  if (!nemoExists) {
    // Se o usu√°rio Nemo n√£o existe, cria automaticamente
    await createDefaultAdmin();
  } else {
    // Se j√° existe, atualiza a senha para "gustavo270908"
    await updateAdminPassword();
  }
}

/* ======= CRIA√á√ÉO DO ADMIN PADR√ÉO ======= */
async function createDefaultAdmin() {
  // Senha personalizada para o usu√°rio Nemo
  const customPassword = "gustavo270908";
  const passHash = await hash(customPassword);
  
  // Cria o usu√°rio Nemo
  localStorage.setItem("user_Nemo", passHash);
  localStorage.setItem("role_Nemo", "admin");
  
  // Cria metadados do usu√°rio Nemo
  const ua = navigator.userAgent;
  const createdAt = new Date().toISOString();
  let ip = "127.0.0.1";
  
  try {
    const res = await fetch('https://api.ipify.org?format=json');
    if(res.ok) {
      const data = await res.json();
      ip = data.ip;
    }
  } catch(e) {
    // Usa IP padr√£o se n√£o conseguir obter
  }
  
  const meta = {
    role: "admin",
    createdAt,
    createdIP: ip,
    createdUA: ua,
    banned: false,
    logins: []
  };
  
  localStorage.setItem("meta_Nemo", JSON.stringify(meta));
  console.log("Usu√°rio admin 'Nemo' criado automaticamente. Senha: gustavo270908");
}

/* ======= ATUALIZA√á√ÉO DE SENHA DO ADMIN ======= */
async function updateAdminPassword() {
  // Atualiza a senha do usu√°rio Nemo para "gustavo270908"
  const newPassword = "gustavo270908";
  const newPassHash = await hash(newPassword);
  
  // Atualiza no localStorage
  localStorage.setItem("user_Nemo", newPassHash);
  
  // Garante que o role seja admin
  localStorage.setItem("role_Nemo", "admin");
  
  // Atualiza metadados se necess√°rio
  const metaKey = "meta_Nemo";
  let meta = JSON.parse(localStorage.getItem(metaKey) || '{}');
  meta.role = "admin";
  meta.banned = false; // Garante que n√£o esteja banido
  localStorage.setItem(metaKey, JSON.stringify(meta));
  
  console.log("Senha do admin 'Nemo' atualizada para: gustavo270908");
}

/* ======= LOG ======= */
let logs=[];
function log(m){
  logs.push(m);
  const terminal = document.getElementById('terminal');
  if (terminal) {
    terminal.innerHTML += `<span>> ${m}</span><br>`;
    terminal.scrollTop = terminal.scrollHeight;
  }
}

/* ======= AUTH ======= */
async function register(){
  if(!rUser.value||!rPass.value) return alert("Campos vazios");
  const username = rUser.value.trim();
  
  // Verifica se o usu√°rio j√° existe
  if(localStorage.getItem("user_"+username)) return alert("Usu√°rio j√° existe");
  
  // Permite criar qualquer usu√°rio (incluindo Nemo se n√£o existir)
  const passHash = await hash(rPass.value);
  localStorage.setItem("user_"+username, passHash);
  
  // Define role padr√£o como "user"
  const role = "user";
  localStorage.setItem("role_"+username, role);
  
  // Cria metadados
  const ua = navigator.userAgent;
  const createdAt = new Date().toISOString();
  const ip = await getIP().catch(()=>"127.0.0.1");
  const meta = {
    role, 
    createdAt, 
    createdIP: ip, 
    createdUA: ua, 
    banned: false, 
    logins: [],
    deviceInfo: deviceDetector ? deviceDetector.getDeviceInfo() : null
  };
  localStorage.setItem("meta_"+username, JSON.stringify(meta));
  
  alert("Conta criada com sucesso!"); 
  showLogin();
}

async function login(){
  const username = lUser.value.trim();
  const password = lPass.value;
  
  if(!username || !password) return alert("Preencha todos os campos");
  
  // Busca o hash da senha armazenada
  const storedHash = localStorage.getItem("user_"+username);
  if(!storedHash) return alert("Usu√°rio n√£o encontrado");
  
  // Calcula hash da senha fornecida
  const inputHash = await hash(password);
  
  // Compara os hashes
  if(storedHash === inputHash){
    // Verifica se a conta est√° banida
    const metaKey = "meta_"+username;
    const meta = JSON.parse(localStorage.getItem(metaKey) || '{}');
    if(meta.banned) return alert('Conta banida');
    
    // Registra o login
    const ip = await getIP().catch(()=>"127.0.0.1");
    const entry = {
      at: new Date().toISOString(), 
      ip: ip, 
      ua: navigator.userAgent,
      deviceInfo: deviceDetector ? deviceDetector.getDeviceInfo() : null
    };
    meta.logins = meta.logins || [];
    meta.logins.push(entry);
    localStorage.setItem(metaKey, JSON.stringify(meta));
    
    // Cria sess√£o
    localStorage.setItem("session", username);
    
    // Abre o painel
    openPainel();
  } else {
    alert("Senha incorreta");
  }
}

function logout(){
  localStorage.removeItem("session");
  document.getElementById('loginBtn').style.display = 'block';
  document.getElementById('registerBtn').style.display = 'block';
  document.getElementById('painelBtn').style.display = 'none';
  document.getElementById('logoutBtn').style.display = 'none';
  showLogin();
}

/* ======= UI ======= */
function hideAll(){
  loginBox.classList.add("hidden");
  registerBox.classList.add("hidden");
  painelBox.classList.add("hidden");
}

function showLogin(){
  hideAll();
  loginBox.classList.remove("hidden");
  lUser.value = "";
  lPass.value = "";
}

function showRegister(){
  hideAll();
  registerBox.classList.remove("hidden");
  rUser.value = "";
  rPass.value = "";
}

function openPainel(){
  const u = localStorage.getItem("session"); 
  if(!u) return alert("Fa√ßa login primeiro");
  
  hideAll(); 
  painelBox.classList.remove("hidden");
  userName.textContent = u;
  
  const role = localStorage.getItem("role_"+u) || "user";
  userRole.textContent = role;
  
  // Mostrar painel admin apenas para o usu√°rio 'Nemo'
  document.querySelector(".admin").style.display = (u === "Nemo") ? "block" : "none";
  
  // Atualizar bot√µes da sidebar
  document.getElementById('loginBtn').style.display = 'none';
  document.getElementById('registerBtn').style.display = 'none';
  document.getElementById('painelBtn').style.display = 'block';
  document.getElementById('logoutBtn').style.display = 'block';
  
  // Limpar e iniciar terminal
  const terminal = document.getElementById('terminal');
  if (terminal) terminal.innerHTML = ""; 
  
  log("Sistema Nemo iniciado");
  log(`Bem-vindo, ${u}`);
  
  if (deviceDetector) {
    const deviceInfo = deviceDetector.getDeviceInfo();
    log(`Dispositivo: ${deviceInfo.type} | OS: ${deviceInfo.os}`);
    log(`Navegador: ${deviceInfo.browser} | Conex√£o: ${deviceInfo.connection}`);
  }
  
  startChart();
}

/* ======= MODAIS ======= */
function openModal(t){
  modal.style.display = "flex";
  modalTitle.textContent = t.toUpperCase();
  
  if(t === "scanner") modalBody.innerHTML = `<button onclick="scan()" class="pulse">Iniciar Scan</button>`;
  if(t === "network") modalBody.innerHTML = `<button onclick="ping()">Testar Ping</button>`;
  if(t === "tools") modalBody.innerHTML = `<button onclick="gen()">Gerar Senha Segura</button>`;
  if(t === "config") modalBody.innerHTML = `<button onclick="toggle()">Alternar Tema</button>`;
  
  if(t === "admin"){
    const current = localStorage.getItem('session');
    if(current !== 'Nemo'){
      modalBody.innerHTML = `<p style="color:var(--primary-light); padding: 20px; text-align: center;">Acesso restrito ao administrador</p>`;
      return;
    }
    modalBody.innerHTML = `<div id="adminContainer"></div>`;
    renderAdmin();
  }
}

function closeModal(){
  modal.style.display = "none";
  modalBody.innerHTML = "";
}

/* ======= A√á√ïES ======= */
function scan(){
  log("Iniciando scan de portas...");
  [21,22,80,443].forEach((p,i)=>setTimeout(()=>{
    const status = Math.random()>.5?"ABERTA":"FECHADA";
    log(`Porta ${p}: ${status}`);
  },i*300))
}

function ping(){
  log("Enviando ping...");
  setTimeout(()=>{
    const latency = (20+Math.random()*80).toFixed(0);
    log(`Ping: ${latency}ms`);
  },500)
}

async function gen(){
  const p = Math.random().toString(36).slice(-10);
  log("Gerando senha segura...");
  setTimeout(async ()=>{
    log(`Senha: ${p}`);
    log(`SHA256: ${await hash(p)}`);
  },300)
}

function toggle(){
  const root = document.documentElement;
  const currentPrimary = getComputedStyle(root).getPropertyValue("--primary").trim();
  
  if(currentPrimary === "#b00000"){
    root.style.setProperty("--primary", "#00cc88");
    root.style.setProperty("--primary-light", "#33ffaa");
    log("Tema alterado: Modo Verde");
  } else if(currentPrimary === "#00cc88"){
    root.style.setProperty("--primary", "#ffaa00");
    root.style.setProperty("--primary-light", "#ffcc44");
    log("Tema alterado: Modo Laranja");
  } else {
    root.style.setProperty("--primary", "#b00000");
    root.style.setProperty("--primary-light", "#ff3333");
    log("Tema alterado: Modo Vermelho (Padr√£o)");
  }
}

function resetSys(){
  if(confirm("Isso ir√° resetar todo o sistema. Tem certeza?")){
    localStorage.clear();
    initializeSystem(); // Recria o admin padr√£o com a nova senha
    location.reload();
  }
}

/* ======= FUN√á√ïES UTILIT√ÅRIAS ======= */
async function getIP(){
  try{
    const res = await fetch('https://api.ipify.org?format=json');
    if(!res.ok) throw new Error('Erro na requisi√ß√£o');
    const j = await res.json();
    return j.ip;
  }catch(e){
    return "127.0.0.1";
  }
}

function getAllUsers(){
  const users = [];
  for(let i = 0; i < localStorage.length; i++){
    const k = localStorage.key(i);
    if(k && k.startsWith('user_')){
      const username = k.slice(5);
      const meta = JSON.parse(localStorage.getItem('meta_'+username) || '{}');
      const role = localStorage.getItem('role_'+username) || meta.role || 'user';
      users.push({username, role, meta});
    }
  }
  return users.sort((a,b)=>a.username.localeCompare(b.username));
}

function renderAdmin(){
  const container = document.getElementById('adminContainer');
  const users = getAllUsers();
  let html = `<div style="max-height:320px;overflow:auto; margin-bottom: 20px;"><table style="width:100%;border-collapse:collapse; color: #fff;">`;
  html += `<thead><tr style="text-align:left;color:var(--primary-light); background: rgba(176, 0, 0, 0.1);"><th>Usu√°rio</th><th>Role</th><th>Criado</th><th>IP</th><th>Ban</th><th>A√ß√µes</th></tr></thead><tbody>`;
  
  users.forEach(u=>{
    const created = u.meta.createdAt ? new Date(u.meta.createdAt).toLocaleDateString() : '‚Äî';
    const ip = u.meta.createdIP || '‚Äî';
    const banned = u.meta.banned ? 'Sim' : 'N√£o';
    const bannedClass = u.meta.banned ? 'style="color: var(--primary-light)"' : '';
    
    html += `<tr>
      <td>${u.username}</td>
      <td>${u.role}</td>
      <td>${created}</td>
      <td>${ip}</td>
      <td ${bannedClass}>${banned}</td>
      <td>
        <button data-user="${u.username}" data-action="view" style="margin-right: 5px; padding: 5px 10px; background: rgba(255,255,255,0.1); border: 1px solid var(--gray-light); border-radius: 5px; color: white; cursor: pointer;">Ver</button>
        <button data-user="${u.username}" data-action="toggle" style="padding: 5px 10px; background: ${u.meta.banned ? 'rgba(0,204,136,0.2)' : 'rgba(176,0,0,0.2)'}; border: 1px solid ${u.meta.banned ? 'var(--success)' : 'var(--primary)'}; border-radius: 5px; color: white; cursor: pointer;">${u.meta.banned ? 'Desbanir' : 'Banir'}</button>
      </td>
    </tr>`;
  });
  
  html += `</tbody></table></div>`;
  html += `<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
    <button onclick="modalBody.innerHTML='<h4>Reset do Sistema</h4><p style=\'margin-bottom: 15px;\'>Esta a√ß√£o ir√° apagar todos os dados (exceto o admin Nemo). Use com cuidado.</p><button onclick=\'resetSys()\' style=\'background: var(--primary); color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;\'>Resetar Sistema</button>'">Reset Sistema</button>
  </div>`;
  
  container.innerHTML = html;
  
  container.querySelectorAll('button[data-user]').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const u = e.currentTarget.getAttribute('data-user');
      const a = e.currentTarget.getAttribute('data-action');
      if(a === 'view') viewUser(u);
      if(a === 'toggle') toggleBan(u);
    });
  });
}

function viewUser(username){
  const meta = JSON.parse(localStorage.getItem('meta_'+username) || '{}');
  const role = localStorage.getItem('role_'+username) || meta.role || 'user';
  
  let html = `<div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 10px; margin-bottom: 15px;">
    <h4 style="color: var(--primary-light); margin-bottom: 10px;">${username}</h4>
    <p><strong>Role:</strong> ${role}</p>
    <p><strong>Criado:</strong> ${meta.createdAt ? new Date(meta.createdAt).toLocaleString() : '‚Äî'}</p>
    <p><strong>IP de Cria√ß√£o:</strong> ${meta.createdIP || '‚Äî'}</p>
    <p><strong>User Agent:</strong> <small>${meta.createdUA || '‚Äî'}</small></p>
  </div>`;
  
  // Show device info if available
  if (meta.deviceInfo) {
    html += `<div style="padding: 10px; background: rgba(176, 0, 0, 0.1); border-radius: 10px; margin-bottom: 15px;">
      <h5 style="color: var(--primary-light); margin-bottom: 5px;">üì± Informa√ß√µes do Dispositivo (Cria√ß√£o):</h5>
      <p><small>${meta.deviceInfo.type} | ${meta.deviceInfo.os} | ${meta.deviceInfo.browser}</small></p>
    </div>`;
  }
  
  html += `<h5 style="margin-top: 20px; color: var(--gray-light);">Hist√≥rico de Logins:</h5>`;
  
  if(meta.logins && meta.logins.length){
    html += `<div style="max-height:200px;overflow:auto; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;"><ul style="list-style: none;">` + 
            meta.logins.slice().reverse().map(l=>{
              let loginInfo = `<li style="padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                <small>${new Date(l.at).toLocaleString()} ‚Äî ${l.ip || '‚Äî'}</small>`;
              
              if (l.deviceInfo) {
                loginInfo += `<br><small style="color: var(--gray-light);">üì± ${l.deviceInfo.type} | ${l.deviceInfo.os}</small>`;
              }
              
              loginInfo += `</li>`;
              return loginInfo;
            }).join('') + 
            `</ul></div>`;
  } else {
    html += `<p style="color: var(--gray);">Sem logins registrados</p>`;
  }
  
  html += `<div style="margin-top:20px; display: flex; gap: 10px;">
    <button onclick="renderAdmin()" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid var(--gray-light); border-radius: 8px; color: white; cursor: pointer;">Voltar</button>
    <button onclick="toggleBan('${username}')" style="flex: 1; padding: 10px; background: ${meta.banned ? 'rgba(0,204,136,0.2)' : 'rgba(176,0,0,0.2)'}; border: 1px solid ${meta.banned ? 'var(--success)' : 'var(--primary)'}; border-radius: 8px; color: white; cursor: pointer;">${meta.banned ? 'Desbanir' : 'Banir'}</button>
  </div>`;
  
  modalBody.innerHTML = html;
}

function toggleBan(username){
  if(username === "Nemo") {
    alert("N√£o √© poss√≠vel banir o administrador principal.");
    return;
  }
  
  const key = 'meta_'+username;
  const meta = JSON.parse(localStorage.getItem(key) || '{}');
  meta.banned = !meta.banned;
  localStorage.setItem(key, JSON.stringify(meta));
  log(`Usu√°rio ${username} ${meta.banned ? 'banido' : 'desbanido'}`);
  renderAdmin();
}

function exportLogs(){
  if(logs.length === 0) {
    alert("Nenhum log para exportar.");
    return;
  }
  const csv = logs.join("\n");
  const a = document.createElement("a");
  a.href = URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download = `nemo_logs_${new Date().toISOString().slice(0,10)}.csv`; 
  a.click();
  log("Logs exportados com sucesso");
}

/* ======= CHART ======= */
let ctx = document.getElementById("chart").getContext("2d");
let data = [];

function startChart(){
  data = []; 
  setInterval(()=>{
    data.push(Math.random()*100); 
    if(data.length > 20) data.shift();
    
    const chartCanvas = document.getElementById("chart");
    if (!chartCanvas) return;
    
    ctx.clearRect(0,0,chartCanvas.width,chartCanvas.height);
    
    // Gradiente para o gr√°fico
    const gradient = ctx.createLinearGradient(0, 0, chartCanvas.width, 0);
    gradient.addColorStop(0, getComputedStyle(document.documentElement).getPropertyValue("--primary"));
    gradient.addColorStop(1, getComputedStyle(document.documentElement).getPropertyValue("--primary-light"));
    
    ctx.strokeStyle = gradient;
    ctx.lineWidth = 2;
    ctx.beginPath();
    data.forEach((v,i)=>ctx.lineTo(i*(chartCanvas.width/20),chartCanvas.height-v));
    ctx.stroke();
    
    // Pontos no gr√°fico
    ctx.fillStyle = gradient;
    data.forEach((v,i)=>{
      ctx.beginPath();
      ctx.arc(i*(chartCanvas.width/20),chartCanvas.height-v,3,0,Math.PI*2);
      ctx.fill();
    });
  },1000);
}

/* ======= INICIALIZA√á√ÉO DA P√ÅGINA ======= */
window.onload = async function() {
  // Inicializa o sistema (cria/atualiza admin com nova senha)
  await initializeSystem();
  
  // Verifica se j√° existe uma sess√£o ativa
  if(localStorage.getItem("session")) {
    openPainel();
  } else {
    document.getElementById('loginBtn').style.display = 'block';
    document.getElementById('registerBtn').style.display = 'block';
    document.getElementById('painelBtn').style.display = 'none';
    document.getElementById('logoutBtn').style.display = 'none';
    showLogin();
  }
};

// Handle window resize for responsive design
window.addEventListener('resize', () => {
  if (deviceDetector) {
    deviceDetector.detectScreen();
  }
  
  // Close mobile menu on resize to larger screens
  if (window.innerWidth > 768) {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    if (sidebar && overlay) {
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    }
  }
});
</script>
</body>
</html>
